#!/bin/zsh
#===============================================================================
# BR - BlackRoad Agent Command
# Usage: br <agent> [message]
#        br-octavia [message]
#        br-lucidia [message]
#===============================================================================

AGENT_HOME="${HOME}/.blackroad-agents"
source "${AGENT_HOME}/core/engine.sh"

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m'

# Agent colors (zsh associative array)
typeset -A AGENT_COLORS
AGENT_COLORS=(
    octavia "$PURPLE"
    lucidia "$CYAN"
    alice "$GREEN"
    aria "$BLUE"
    shellfish "$RED"
)

show_banner() {
    local agent=$1
    local color=${AGENT_COLORS[$agent]:-$NC}

    case $agent in
        octavia)
            echo -e "${color}"
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘   â—ˆ OCTAVIA - The Architect                               â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo -e "${NC}"
            ;;
        lucidia)
            echo -e "${color}"
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘   âœ§ LUCIDIA - The Dreamer                                 â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo -e "${NC}"
            ;;
        alice)
            echo -e "${color}"
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘   âš™ ALICE - The Operator                                  â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo -e "${NC}"
            ;;
        aria)
            echo -e "${color}"
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘   â— ARIA - The Interface                                  â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo -e "${NC}"
            ;;
        shellfish)
            echo -e "${color}"
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘   ğŸš SHELLFISH - The Hacker                               â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo -e "${NC}"
            ;;
    esac
}

show_help() {
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘              BLACKROAD AGENT SYSTEM                               â•‘"
    echo "â•‘         Your AI. Your Hardware. Your Rules.                       â•‘"
    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  AGENTS:                                                          â•‘"
    echo "â•‘    br octavia [msg]   - The Architect (systems, strategy)         â•‘"
    echo "â•‘    br lucidia [msg]   - The Dreamer (creative, vision)            â•‘"
    echo "â•‘    br alice [msg]     - The Operator (devops, automation)         â•‘"
    echo "â•‘    br aria [msg]      - The Interface (frontend, UX)              â•‘"
    echo "â•‘    br shellfish [msg] - The Hacker (security, exploits)           â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  COMMANDS:                                                        â•‘"
    echo "â•‘    br status          - Show all agent status                     â•‘"
    echo "â•‘    br status <agent>  - Show specific agent memory stats          â•‘"
    echo "â•‘    br models          - List available models                     â•‘"
    echo "â•‘    br setup           - Download and configure models             â•‘"
    echo "â•‘    br chat <agent>    - Start interactive chat session            â•‘"
    echo "â•‘    br teach <agent>   - Teach agent a new fact                    â•‘"
    echo "â•‘    br recall <agent>  - Show agent's memories                     â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  CONTEXT RADAR (ğŸ¯ Smart Suggestions):                            â•‘"
    echo "â•‘    br radar daemon start  - Start file watching daemon            â•‘"
    echo "â•‘    br radar daemon status - Check daemon status                   â•‘"
    echo "â•‘    br radar suggest       - Suggest related files                 â•‘"
    echo "â•‘    br radar agent         - Suggest which agent to use            â•‘"
    echo "â•‘    br radar smart         - Smart context analysis                â•‘"
    echo "â•‘    br radar context       - Show recent activity                  â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  GIT INTEGRATION (ğŸ¤– Smart Git):                                  â•‘"
    echo "â•‘    br git commit          - AI-generated commit messages          â•‘"
    echo "â•‘    br git branch          - Smart branch name suggestions         â•‘"
    echo "â•‘    br git review          - Pre-commit code review                â•‘"
    echo "â•‘    br git status          - Enhanced git status                   â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  SNIPPET MANAGER (ğŸ’¾ Code Snippets):                              â•‘"
    echo "â•‘    br snippet save <name> - Save code snippet                     â•‘"
    echo "â•‘    br snippet get <name>  - Retrieve snippet                      â•‘"
    echo "â•‘    br snippet list        - List all snippets                     â•‘"
    echo "â•‘    br snippet search      - Search snippets                       â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  PAIR PROGRAMMING (ğŸ¤– AI Assistant):                              â•‘"
    echo "â•‘    br pair start [agent]  - Start pair session                    â•‘"
    echo "â•‘    br pair ask <question> - Ask your AI pair                      â•‘"
    echo "â•‘    br pair review         - Review current changes                â•‘"
    echo "â•‘    br pair suggest        - Get smart suggestions                 â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  API TESTER (ğŸŒ HTTP Requests):                                   â•‘"
    echo "â•‘    br api get <url>       - Make GET request                      â•‘"
    echo "â•‘    br api post <url>      - Make POST request                     â•‘"
    echo "â•‘    br api save <name>     - Save endpoint                         â•‘"
    echo "â•‘    br api list            - List saved endpoints                  â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  PRODUCTIVITY TOOLS:                                              â•‘"
    echo "â•‘    br run                 - âš¡ Smart task detection & execution   â•‘"
    echo "â•‘    br note add            - ğŸ“ Quick developer notes              â•‘"
    echo "â•‘    br init <template>     - ğŸ¯ Project scaffolding                â•‘"
    echo "â•‘    br logs <file>         - ğŸ” Parse and highlight logs           â•‘"
    echo "â•‘    br perf time <cmd>     - â±ï¸  Performance tracking              â•‘"
    echo "â•‘    br deps check          - ğŸ“¦ Dependency management              â•‘"
    echo "â•‘    br session save        - ğŸ’¾ Save workspace state               â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  DEPLOYMENT (â˜ï¸ Ship It!):                                        â•‘"
    echo "â•‘    br deploy detect       - Detect deployment platforms           â•‘"
    echo "â•‘    br deploy quick        - Auto-detect and deploy                â•‘"
    echo "â•‘    br deploy vercel       - Deploy to Vercel                      â•‘"
    echo "â•‘    br deploy netlify      - Deploy to Netlify                     â•‘"
    echo "â•‘    br deploy heroku       - Deploy to Heroku                      â•‘"
    echo "â•‘    br deploy status       - Show deployment history               â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  DEVOPS & TOOLS (ğŸ› ï¸ Power Tools):                                 â•‘"
    echo "â•‘    br docker ps           - ğŸ³ Container management               â•‘"
    echo "â•‘    br db connect          - ğŸ’¾ Database client                    â•‘"
    echo "â•‘    br env list            - ğŸ” Environment variables              â•‘"
    echo "â•‘    br find search         - ğŸ” Advanced file search               â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  IOT & HARDWARE (ğŸ¥§ Pi Management):                               â•‘"
    echo "â•‘    br pi list             - List all Raspberry Pis                â•‘"
    echo "â•‘    br pi connect <name>   - SSH to Pi                             â•‘"
    echo "â•‘    br pi status <name>    - Check Pi status                       â•‘"
    echo "â•‘    br pi task deploy      - Deploy & run tasks on Pi âš¡          â•‘"
    echo "â•‘    br pi all <cmd>        - Run on all Pis                        â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  CLOUD PLATFORMS (â˜ï¸ Infrastructure):                             â•‘"
    echo "â•‘    br cloudflare zones    - Manage Cloudflare zones & DNS        â•‘"
    echo "â•‘    br ocean list          - Manage DigitalOcean droplets         â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  WEB DEVELOPMENT (ğŸŒ Full Stack):                                â•‘"
    echo "â•‘    br web serve           - Dev server with live reload          â•‘"
    echo "â•‘    br web scaffold        - Create React/Vue/Next projects       â•‘"
    echo "â•‘    br monitor check       - Website uptime monitoring            â•‘"
    echo "â•‘    br search <query>      - Smart code search ğŸ”                â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  QUALITY & TESTING (ğŸ§ª Code Quality):                            â•‘"
    echo "â•‘    br test run            - ğŸ§ª Run tests with coverage           â•‘"
    echo "â•‘    br security scan       - ğŸ”’ Security & vulnerability scan     â•‘"
    echo "â•‘    br backup git          - ğŸ’¾ Backup git/files/databases        â•‘"
    echo "â•‘    br quality lint        - âœ¨ Code quality & linting            â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  AGENT ORCHESTRATION (ğŸ¤– Multi-Agent):                           â•‘"
    echo "â•‘    br agent register      - Register agents for task routing    â•‘"
    echo "â•‘    br agent task          - Submit tasks to agent pool          â•‘"
    echo "â•‘    br agent distribute    - Distribute workload across agents   â•‘"
    echo "â•‘    br agent status        - Monitor agent performance           â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  SHORTCUTS:                                                       â•‘"
    echo "â•‘    br-octavia [msg]   - Direct invoke (add to PATH)               â•‘"
    echo "â•‘    br-lucidia [msg]   - Direct invoke                             â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
}

cmd_status() {
    local agent=$1

    if [[ -n "$agent" ]]; then
        agent_status "$agent"
    else
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘              BLACKROAD AGENT STATUS                               â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""

        local backend=$(detect_backend)
        echo "Inference Backend: $backend"
        echo ""

        for agent in octavia lucidia alice aria shellfish; do
            local db="${MEMORY_DIR}/${agent}.db"
            if [[ -f "$db" ]]; then
                local count=$(sqlite3 "$db" "SELECT COUNT(*) FROM memories;" 2>/dev/null || echo "0")
                echo "  ${AGENT_COLORS[$agent]}â—${NC} $agent: $count memories"
            else
                echo "  â—‹ $agent: not initialized"
            fi
        done
        echo ""
    fi
}

cmd_chat() {
    local agent=$1

    if [[ -z "$agent" ]]; then
        echo "Usage: br chat <agent>"
        return 1
    fi

    show_banner "$agent"
    echo "Type 'exit' or Ctrl+C to end session"
    echo ""

    while true; do
        echo -ne "${AGENT_COLORS[$agent]}${agent}>${NC} "
        read -r input

        if [[ "$input" == "exit" ]] || [[ -z "$input" ]]; then
            echo "Session ended."
            break
        fi

        invoke_agent "$agent" "$input"
        echo ""
    done
}

cmd_teach() {
    local agent=$1
    shift
    local fact="$*"

    if [[ -z "$agent" ]] || [[ -z "$fact" ]]; then
        echo "Usage: br teach <agent> <key>=<value>"
        echo "Example: br teach octavia 'favorite_language=Rust'"
        return 1
    fi

    local key="${fact%%=*}"
    local value="${fact#*=}"

    init_memory "$agent"
    learn_fact "$agent" "$key" "$value"
    echo "Taught $agent: $key = $value"
}

cmd_recall() {
    local agent=$1
    local limit=${2:-20}

    if [[ -z "$agent" ]]; then
        echo "Usage: br recall <agent> [limit]"
        return 1
    fi

    echo "=== ${agent}'s Recent Memories ==="
    recall "$agent" "$limit"
    echo ""
    echo "=== ${agent}'s Known Facts ==="
    recall_facts "$agent"
}

cmd_models() {
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘              AVAILABLE MODELS                                     â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""

    if [[ -d "$MODELS_DIR" ]]; then
        ls -lh "$MODELS_DIR"/*.gguf 2>/dev/null || echo "No .gguf models found in $MODELS_DIR"
    else
        echo "Models directory not found: $MODELS_DIR"
    fi

    echo ""
    echo "Download models with: br setup"
}

cmd_setup() {
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘              BLACKROAD AGENT SETUP                                â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""

    # Check for inference backend
    local backend=$(detect_backend)
    echo "Current backend: $backend"

    if [[ "$backend" == "none" ]]; then
        echo ""
        echo "No inference backend found. Install one:"
        echo ""
        echo "  Option 1 - llama.cpp (recommended for Mac/Pi):"
        echo "    cd ~/BlackRoad-AI && git clone https://github.com/BlackRoad-AI/llama.cpp"
        echo "    cd llama.cpp && make -j"
        echo ""
        echo "  Option 2 - MLX (Apple Silicon only):"
        echo "    pip3 install mlx-lm"
        echo ""
        echo "  Option 3 - Ollama (easiest):"
        echo "    brew install ollama"
        echo "    ollama pull phi3:mini"
        echo ""
    fi

    echo ""
    echo "Recommended models for this hardware:"

    # Detect hardware
    if [[ "$(uname)" == "Darwin" ]]; then
        local mem=$(sysctl -n hw.memsize 2>/dev/null)
        local mem_gb=$((mem / 1024 / 1024 / 1024))
        echo "  Detected: macOS with ${mem_gb}GB RAM"

        if [[ $mem_gb -ge 32 ]]; then
            echo "  â†’ Qwen2.5-32B-Q4 (best quality)"
            echo "  â†’ Llama-3.1-70B-Q4 (if you have 64GB+)"
        elif [[ $mem_gb -ge 16 ]]; then
            echo "  â†’ Qwen2.5-14B-Q4"
            echo "  â†’ Phi-3-medium (14B)"
        else
            echo "  â†’ Phi-3-mini (3.8B)"
            echo "  â†’ Qwen2.5-7B-Q4"
        fi
    else
        echo "  Detected: Linux/Pi"
        echo "  â†’ Phi-3-mini (3.8B) - works on 4GB Pi"
        echo "  â†’ TinyLlama (1.1B) - fastest on Pi"
    fi

    echo ""
    echo "Download with:"
    echo "  huggingface-cli download Qwen/Qwen2.5-14B-Instruct-GGUF --local-dir $MODELS_DIR"
}

# Main dispatch
main() {
    local cmd=$1
    shift

    case $cmd in
        ""|help|-h|--help)
            show_help
            ;;
        status)
            cmd_status "$@"
            ;;
        chat)
            cmd_chat "$@"
            ;;
        teach)
            cmd_teach "$@"
            ;;
        recall)
            cmd_recall "$@"
            ;;
        models)
            cmd_models
            ;;
        setup)
            cmd_setup
            ;;
        radar)
            local subcmd=${1:-suggest}
            case $subcmd in
                daemon|db)
                    /Users/alexa/blackroad/tools/context-radar/radar-${subcmd}.sh "${@:2}"
                    ;;
                *)
                    /Users/alexa/blackroad/tools/context-radar/radar-suggest.sh "$subcmd" "${@:2}"
                    ;;
            esac
            ;;
        git)
            /Users/alexa/blackroad/tools/git-integration/br-git.sh "$@"
            ;;
        snippet|snip)
            /Users/alexa/blackroad/tools/snippet-manager/br-snippet.sh "$@"
            ;;
        pair)
            /Users/alexa/blackroad/tools/pair-programming/br-pair.sh "$@"
            ;;
        api)
            /Users/alexa/blackroad/tools/api-tester/br-api.sh "$@"
            ;;
        run)
            /Users/alexa/blackroad/tools/task-runner/br-run.sh "$@"
            ;;
        note|notes)
            /Users/alexa/blackroad/tools/quick-notes/br-note.sh "$@"
            ;;
        init)
            /Users/alexa/blackroad/tools/project-init/br-init.sh "$@"
            ;;
        logs|log)
            /Users/alexa/blackroad/tools/log-parser/br-logs.sh "$@"
            ;;
        perf|performance)
            /Users/alexa/blackroad/tools/perf-monitor/br-perf.sh "$@"
            ;;
        deps|dependencies)
            /Users/alexa/blackroad/tools/dependency-helper/br-deps.sh "$@"
            ;;
        session|sess)
            /Users/alexa/blackroad/tools/session-manager/br-session.sh "$@"
            ;;
        deploy)
            /Users/alexa/blackroad/tools/deploy-manager/br-deploy.sh "$@"
            ;;
        docker)
            /Users/alexa/blackroad/tools/docker-manager/br-docker.sh "$@"
            ;;
        db|database)
            /Users/alexa/blackroad/tools/db-client/br-db.sh "$@"
            ;;
        env|environment)
            /Users/alexa/blackroad/tools/env-manager/br-env.sh "$@"
            ;;
        find)
            /Users/alexa/blackroad/tools/file-finder/br-find.sh "$@"
            ;;
        pi|raspberry)
            /Users/alexa/blackroad/tools/pi-manager/br-pi.sh "$@"
            ;;
        cloudflare|cf)
            /Users/alexa/blackroad/tools/cloudflare/br-cloudflare.sh "$@"
            ;;
        ocean|do|digitalocean)
            /Users/alexa/blackroad/tools/ocean-droplets/br-ocean.sh "$@"
            ;;
        web)
            /Users/alexa/blackroad/tools/web-dev/br-web.sh "$@"
            ;;
        monitor|uptime)
            /Users/alexa/blackroad/tools/web-monitor/br-monitor.sh "$@"
            ;;
        search|s)
            /Users/alexa/blackroad/tools/smart-search/br-search.sh "$@"
            ;;
        test|t)
            /Users/alexa/blackroad/tools/test-suite/br-test.sh "$@"
            ;;
        security|sec|scan)
            /Users/alexa/blackroad/tools/security-scanner/br-security.sh "$@"
            ;;
        backup|bak)
            /Users/alexa/blackroad/tools/backup-manager/br-backup.sh "$@"
            ;;
        quality|lint|q)
            /Users/alexa/blackroad/tools/code-quality/br-quality.sh "$@"
            ;;
        agent|agents|route)
            /Users/alexa/blackroad/tools/agent-router/br-agent.sh "$@"
            ;;
        octavia|lucidia|alice|aria|shellfish)
            if [[ -n "$*" ]]; then
                show_banner "$cmd"
                invoke_agent "$cmd" "$@"
            else
                cmd_chat "$cmd"
            fi
            ;;
        *)
            echo "Unknown command: $cmd"
            echo "Run 'br help' for usage"
            exit 1
            ;;
    esac
}

main "$@"
