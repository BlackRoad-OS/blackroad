#!/bin/zsh
#===============================================================================
# BR - BlackRoad Agent Command
# Usage: br <agent> [message]
#        br-octavia [message]
#        br-lucidia [message]
#===============================================================================

AGENT_HOME="${HOME}/.blackroad-agents"
source "${AGENT_HOME}/core/engine.sh"

# Source shared libraries
BR_LIB="/Users/alexa/blackroad/lib"
[[ -f "${BR_LIB}/colors.sh" ]]  && source "${BR_LIB}/colors.sh"
[[ -f "${BR_LIB}/config.sh" ]]  && source "${BR_LIB}/config.sh"
[[ -f "${BR_LIB}/db.sh" ]]      && source "${BR_LIB}/db.sh"
[[ -f "${BR_LIB}/errors.sh" ]]  && source "${BR_LIB}/errors.sh"
[[ -f "${BR_LIB}/system.sh" ]]  && source "${BR_LIB}/system.sh"
[[ -f "${BR_LIB}/ollama.sh" ]]  && source "${BR_LIB}/ollama.sh"

# Agent colors (zsh associative array â€” kept for backward compat)
typeset -A AGENT_COLORS
AGENT_COLORS=(
    octavia "$PURPLE"
    lucidia "$CYAN"
    alice "$GREEN"
    aria "$BLUE"
    shellfish "$RED"
)

#-------------------------------------------------------------------------------
# Tool routing table: tool_name -> script_path
# Adding a new tool = one line here
#-------------------------------------------------------------------------------
BR_TOOLS_DIR="/Users/alexa/blackroad/tools"
typeset -A BR_TOOLS
BR_TOOLS=(
    radar       "${BR_TOOLS_DIR}/context-radar/radar-suggest.sh"
    git         "${BR_TOOLS_DIR}/git-integration/br-git.sh"
    snippet     "${BR_TOOLS_DIR}/snippet-manager/br-snippet.sh"
    snip        "${BR_TOOLS_DIR}/snippet-manager/br-snippet.sh"
    pair        "${BR_TOOLS_DIR}/pair-programming/br-pair.sh"
    api         "${BR_TOOLS_DIR}/api-tester/br-api.sh"
    run         "${BR_TOOLS_DIR}/task-runner/br-run.sh"
    note        "${BR_TOOLS_DIR}/quick-notes/br-note.sh"
    notes       "${BR_TOOLS_DIR}/quick-notes/br-note.sh"
    init        "${BR_TOOLS_DIR}/project-init/br-init.sh"
    logs        "${BR_TOOLS_DIR}/log-parser/br-logs.sh"
    log         "${BR_TOOLS_DIR}/log-parser/br-logs.sh"
    perf        "${BR_TOOLS_DIR}/perf-monitor/br-perf.sh"
    performance "${BR_TOOLS_DIR}/perf-monitor/br-perf.sh"
    deps        "${BR_TOOLS_DIR}/dependency-helper/br-deps.sh"
    dependencies "${BR_TOOLS_DIR}/dependency-helper/br-deps.sh"
    session     "${BR_TOOLS_DIR}/session-manager/br-session.sh"
    sess        "${BR_TOOLS_DIR}/session-manager/br-session.sh"
    deploy      "${BR_TOOLS_DIR}/deploy-manager/br-deploy.sh"
    docker      "${BR_TOOLS_DIR}/docker-manager/br-docker.sh"
    db          "${BR_TOOLS_DIR}/db-client/br-db.sh"
    database    "${BR_TOOLS_DIR}/db-client/br-db.sh"
    env         "${BR_TOOLS_DIR}/env-manager/br-env.sh"
    environment "${BR_TOOLS_DIR}/env-manager/br-env.sh"
    find        "${BR_TOOLS_DIR}/file-finder/br-find.sh"
    pi          "${BR_TOOLS_DIR}/pi-manager/br-pi.sh"
    raspberry   "${BR_TOOLS_DIR}/pi-manager/br-pi.sh"
    cloudflare  "${BR_TOOLS_DIR}/cloudflare/br-cloudflare.sh"
    cf          "${BR_TOOLS_DIR}/cloudflare/br-cloudflare.sh"
    ocean       "${BR_TOOLS_DIR}/ocean-droplets/br-ocean.sh"
    do          "${BR_TOOLS_DIR}/ocean-droplets/br-ocean.sh"
    digitalocean "${BR_TOOLS_DIR}/ocean-droplets/br-ocean.sh"
    web         "${BR_TOOLS_DIR}/web-dev/br-web.sh"
    monitor     "${BR_TOOLS_DIR}/web-monitor/br-monitor.sh"
    uptime      "${BR_TOOLS_DIR}/web-monitor/br-monitor.sh"
    search      "${BR_TOOLS_DIR}/smart-search/br-search.sh"
    s           "${BR_TOOLS_DIR}/smart-search/br-search.sh"
    test        "${BR_TOOLS_DIR}/test-suite/br-test.sh"
    t           "${BR_TOOLS_DIR}/test-suite/br-test.sh"
    security    "${BR_TOOLS_DIR}/security-scanner/br-security.sh"
    sec         "${BR_TOOLS_DIR}/security-scanner/br-security.sh"
    scan        "${BR_TOOLS_DIR}/security-scanner/br-security.sh"
    backup      "${BR_TOOLS_DIR}/backup-manager/br-backup.sh"
    bak         "${BR_TOOLS_DIR}/backup-manager/br-backup.sh"
    quality     "${BR_TOOLS_DIR}/code-quality/br-quality.sh"
    lint        "${BR_TOOLS_DIR}/code-quality/br-quality.sh"
    q           "${BR_TOOLS_DIR}/code-quality/br-quality.sh"
    agent       "${BR_TOOLS_DIR}/agent-router/br-agent.sh"
    agents      "${BR_TOOLS_DIR}/agent-router/br-agent.sh"
    route       "${BR_TOOLS_DIR}/agent-router/br-agent.sh"
    worker      "${BR_TOOLS_DIR}/worker-bridge/br-worker.sh"
    workers     "${BR_TOOLS_DIR}/worker-bridge/br-worker.sh"
    edge        "${BR_TOOLS_DIR}/worker-bridge/br-worker.sh"
    ci          "${BR_TOOLS_DIR}/ci-pipeline/br-ci.sh"
    pipeline    "${BR_TOOLS_DIR}/ci-pipeline/br-ci.sh"
    notify      "${BR_TOOLS_DIR}/notifications/br-notify.sh"
    notifications "${BR_TOOLS_DIR}/notifications/br-notify.sh"
    metrics     "${BR_TOOLS_DIR}/metrics-dashboard/br-metrics.sh"
    dash        "${BR_TOOLS_DIR}/dashboard/br-dashboard.sh"
    dashboard   "${BR_TOOLS_DIR}/dashboard/br-dashboard.sh"
    world       "${BR_TOOLS_DIR}/world/br-world.sh"
    w           "${BR_TOOLS_DIR}/world/br-world.sh"
    code        "${BR_TOOLS_DIR}/coding-assistant/br-code.sh"
    c           "${BR_TOOLS_DIR}/coding-assistant/br-code.sh"
    stripe      "${BR_TOOLS_DIR}/stripe/br-stripe.sh"
    ssl         "${BR_TOOLS_DIR}/ssl-manager/br-ssl.sh"
    certs       "${BR_TOOLS_DIR}/ssl-manager/br-ssl.sh"
    vercel      "${BR_TOOLS_DIR}/vercel-pro/br-vercel.sh"
    vc          "${BR_TOOLS_DIR}/vercel-pro/br-vercel.sh"
    runtime     "${BR_TOOLS_DIR}/agent-runtime/br-runtime.sh"
    task        "${BR_TOOLS_DIR}/agent-tasks/br-tasks.sh"
    tasks       "${BR_TOOLS_DIR}/agent-tasks/br-tasks.sh"
    vault       "${BR_TOOLS_DIR}/secrets-vault/br-vault.sh"
    secret      "${BR_TOOLS_DIR}/secrets-vault/br-vault.sh"
    secrets     "${BR_TOOLS_DIR}/secrets-vault/br-vault.sh"
    harden      "${BR_TOOLS_DIR}/security-hardening/br-harden.sh"
    hardening   "${BR_TOOLS_DIR}/security-hardening/br-harden.sh"
    comply      "${BR_TOOLS_DIR}/compliance-scanner/br-comply.sh"
    compliance  "${BR_TOOLS_DIR}/compliance-scanner/br-comply.sh"
    gateway     "${BR_TOOLS_DIR}/agent-gateway/br-gateway.sh"
    api-gw      "${BR_TOOLS_DIR}/agent-gateway/br-gateway.sh"
    tpl         "${BR_TOOLS_DIR}/brand/br-brand.sh"
    brand       "${BR_TOOLS_DIR}/brand/br-brand.sh"
    health      "${BR_TOOLS_DIR}/health-check/br-health.sh"
    check       "${BR_TOOLS_DIR}/health-check/br-health.sh"
    diag        "${BR_TOOLS_DIR}/health-check/br-health.sh"
    wifi        "${BR_TOOLS_DIR}/wifi-scanner/br-wifi.sh"
    lan         "${BR_TOOLS_DIR}/wifi-scanner/br-wifi.sh"
    net-scan    "${BR_TOOLS_DIR}/wifi-scanner/br-wifi.sh"
    ai          "${BR_TOOLS_DIR}/ai/br-ai.sh"
    ask         "${BR_TOOLS_DIR}/ai/br-ai.sh"
    journal     "${BR_TOOLS_DIR}/journal/br-journal.sh"
    mem         "${BR_TOOLS_DIR}/journal/br-journal.sh"
    memory      "${BR_TOOLS_DIR}/journal/br-journal.sh"
    collab      "${BR_TOOLS_DIR}/collab/br-collab.sh"
    mesh        "${BR_TOOLS_DIR}/collab/br-collab.sh"
    live        "${BR_TOOLS_DIR}/dashboard/br-dashboard.sh"
    agents      "${BR_TOOLS_DIR}/agents-live/br-agents.sh"
    agent-live  "${BR_TOOLS_DIR}/agents-live/br-agents.sh"
    context     "${BR_TOOLS_DIR}/context/br-context.sh"
    ctx         "${BR_TOOLS_DIR}/context/br-context.sh"
    sync        "${BR_TOOLS_DIR}/sync/br-sync.sh"
    sync-repos  "${BR_TOOLS_DIR}/sync/br-sync.sh"
    snapshot    "${BR_TOOLS_DIR}/snapshot/br-snapshot.sh"
    snap        "${BR_TOOLS_DIR}/snapshot/br-snapshot.sh"
    search      "${BR_TOOLS_DIR}/search/br-search.sh"
    find-all    "${BR_TOOLS_DIR}/search/br-search.sh"
    roundup     "${BR_TOOLS_DIR}/roundup/br-roundup.sh"
    standup     "${BR_TOOLS_DIR}/standup/br-standup.sh"
    timeline    "${BR_TOOLS_DIR}/timeline/br-timeline.sh"
    tl          "${BR_TOOLS_DIR}/timeline/br-timeline.sh"
    pulse       "${BR_TOOLS_DIR}/pulse/br-pulse.sh"
    org         "${BR_TOOLS_DIR}/org/br-org.sh"
    notify      "${BR_TOOLS_DIR}/notify/br-notify.sh"
    cron        "${BR_TOOLS_DIR}/cron/br-cron.sh"
    whoami      "${BR_TOOLS_DIR}/whoami/br-whoami.sh"
    who         "${BR_TOOLS_DIR}/whoami/br-whoami.sh"
    bcast       "${BR_TOOLS_DIR}/broadcast/br-broadcast.sh"
    docs        "${BR_TOOLS_DIR}/docs/br-docs.sh"
    git-ai      "${BR_TOOLS_DIR}/git-ai/br-git-ai.sh"
    gai         "${BR_TOOLS_DIR}/git-ai/br-git-ai.sh"
    review      "${BR_TOOLS_DIR}/review/br-review.sh"
    status-all  "${BR_TOOLS_DIR}/status-all/br-status-all.sh"
    sa          "${BR_TOOLS_DIR}/status-all/br-status-all.sh"
    env-check   "${BR_TOOLS_DIR}/env-check/br-env-check.sh"
    envc        "${BR_TOOLS_DIR}/env-check/br-env-check.sh"
    port        "${BR_TOOLS_DIR}/port/br-port.sh"
    task        "${BR_TOOLS_DIR}/task-manager/br-task-manager.sh"
    tasks       "${BR_TOOLS_DIR}/task-manager/br-task-manager.sh"
    log-tail    "${BR_TOOLS_DIR}/log-tail/br-log-tail.sh"
    logt        "${BR_TOOLS_DIR}/log-tail/br-log-tail.sh"
    ssh         "${BR_TOOLS_DIR}/ssh/br-ssh.sh"
    template    "${BR_TOOLS_DIR}/template/br-template.sh"
    tmpl        "${BR_TOOLS_DIR}/template/br-template.sh"
    fleet       "${BR_TOOLS_DIR}/fleet/br-fleet.sh"
    nodes       "${BR_TOOLS_DIR}/fleet/br-fleet.sh"
)

# Stream shortcut â€” delegates to gateway stream sub-command
stream_events() {
    zsh "${BR_TOOLS_DIR}/agent-gateway/br-gateway.sh" stream
}

dispatch_tool() {
    local tool=$1
    shift
    local script="${BR_TOOLS[$tool]}"
    if [[ -n "$script" && -f "$script" ]]; then
        "$script" "$@"
        return 0
    fi
    return 1
}

show_banner() {
    local agent=$1
    local color=${AGENT_COLORS[$agent]:-$NC}

    case $agent in
        octavia)
            echo -e "${color}"
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘   â—ˆ OCTAVIA - The Architect                               â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo -e "${NC}"
            ;;
        lucidia)
            echo -e "${color}"
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘   âœ§ LUCIDIA - The Dreamer                                 â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo -e "${NC}"
            ;;
        alice)
            echo -e "${color}"
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘   âš™ ALICE - The Operator                                  â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo -e "${NC}"
            ;;
        aria)
            echo -e "${color}"
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘   â— ARIA - The Interface                                  â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo -e "${NC}"
            ;;
        shellfish)
            echo -e "${color}"
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘   ğŸš SHELLFISH - The Hacker                               â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo -e "${NC}"
            ;;
    esac
}

show_help() {
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘              BLACKROAD AGENT SYSTEM                               â•‘"
    echo "â•‘         Your AI. Your Hardware. Your Rules.                       â•‘"
    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  AGENTS:                                                          â•‘"
    echo "â•‘    br octavia [msg]   - The Architect (systems, strategy)         â•‘"
    echo "â•‘    br lucidia [msg]   - The Dreamer (creative, vision)            â•‘"
    echo "â•‘    br alice [msg]     - The Operator (devops, automation)         â•‘"
    echo "â•‘    br aria [msg]      - The Interface (frontend, UX)              â•‘"
    echo "â•‘    br shellfish [msg] - The Hacker (security, exploits)           â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  COMMANDS:                                                        â•‘"
    echo "â•‘    br status          - Show all agent status                     â•‘"
    echo "â•‘    br status <agent>  - Show specific agent memory stats          â•‘"
    echo "â•‘    br models          - List available models                     â•‘"
    echo "â•‘    br setup           - Download and configure models             â•‘"
    echo "â•‘    br chat <agent>    - Start interactive chat session            â•‘"
    echo "â•‘    br teach <agent>   - Teach agent a new fact                    â•‘"
    echo "â•‘    br recall <agent>  - Show agent's memories                     â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  CONTEXT RADAR (ğŸ¯ Smart Suggestions):                            â•‘"
    echo "â•‘    br radar daemon start  - Start file watching daemon            â•‘"
    echo "â•‘    br radar daemon status - Check daemon status                   â•‘"
    echo "â•‘    br radar suggest       - Suggest related files                 â•‘"
    echo "â•‘    br radar agent         - Suggest which agent to use            â•‘"
    echo "â•‘    br radar smart         - Smart context analysis                â•‘"
    echo "â•‘    br radar context       - Show recent activity                  â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  GIT INTEGRATION (ğŸ¤– Smart Git):                                  â•‘"
    echo "â•‘    br git commit          - AI-generated commit messages          â•‘"
    echo "â•‘    br git branch          - Smart branch name suggestions         â•‘"
    echo "â•‘    br git review          - Pre-commit code review                â•‘"
    echo "â•‘    br git status          - Enhanced git status                   â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  SNIPPET MANAGER (ğŸ’¾ Code Snippets):                              â•‘"
    echo "â•‘    br snippet save <name> - Save code snippet                     â•‘"
    echo "â•‘    br snippet get <name>  - Retrieve snippet                      â•‘"
    echo "â•‘    br snippet list        - List all snippets                     â•‘"
    echo "â•‘    br snippet search      - Search snippets                       â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  PAIR PROGRAMMING (ğŸ¤– AI Assistant):                              â•‘"
    echo "â•‘    br pair start [agent]  - Start pair session                    â•‘"
    echo "â•‘    br pair ask <question> - Ask your AI pair                      â•‘"
    echo "â•‘    br pair review         - Review current changes                â•‘"
    echo "â•‘    br pair suggest        - Get smart suggestions                 â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  API TESTER (ğŸŒ HTTP Requests):                                   â•‘"
    echo "â•‘    br api get <url>       - Make GET request                      â•‘"
    echo "â•‘    br api post <url>      - Make POST request                     â•‘"
    echo "â•‘    br api save <name>     - Save endpoint                         â•‘"
    echo "â•‘    br api list            - List saved endpoints                  â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  PRODUCTIVITY TOOLS:                                              â•‘"
    echo "â•‘    br run                 - âš¡ Smart task detection & execution   â•‘"
    echo "â•‘    br note add            - ğŸ“ Quick developer notes              â•‘"
    echo "â•‘    br init <template>     - ğŸ¯ Project scaffolding                â•‘"
    echo "â•‘    br logs <file>         - ğŸ” Parse and highlight logs           â•‘"
    echo "â•‘    br perf time <cmd>     - â±ï¸  Performance tracking              â•‘"
    echo "â•‘    br deps check          - ğŸ“¦ Dependency management              â•‘"
    echo "â•‘    br session save        - ğŸ’¾ Save workspace state               â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  DEPLOYMENT (â˜ï¸ Ship It!):                                        â•‘"
    echo "â•‘    br deploy detect       - Detect deployment platforms           â•‘"
    echo "â•‘    br deploy quick        - Auto-detect and deploy                â•‘"
    echo "â•‘    br deploy vercel       - Deploy to Vercel                      â•‘"
    echo "â•‘    br deploy netlify      - Deploy to Netlify                     â•‘"
    echo "â•‘    br deploy heroku       - Deploy to Heroku                      â•‘"
    echo "â•‘    br deploy status       - Show deployment history               â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  DEVOPS & TOOLS (ğŸ› ï¸ Power Tools):                                 â•‘"
    echo "â•‘    br docker ps           - ğŸ³ Container management               â•‘"
    echo "â•‘    br db connect          - ğŸ’¾ Database client                    â•‘"
    echo "â•‘    br env list            - ğŸ” Environment variables              â•‘"
    echo "â•‘    br find search         - ğŸ” Advanced file search               â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  IOT & HARDWARE (ğŸ¥§ Pi Management):                               â•‘"
    echo "â•‘    br pi list             - List all Raspberry Pis                â•‘"
    echo "â•‘    br pi connect <name>   - SSH to Pi                             â•‘"
    echo "â•‘    br pi status <name>    - Check Pi status                       â•‘"
    echo "â•‘    br pi task deploy      - Deploy & run tasks on Pi âš¡          â•‘"
    echo "â•‘    br pi all <cmd>        - Run on all Pis                        â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  CLOUD PLATFORMS (â˜ï¸ Infrastructure):                             â•‘"
    echo "â•‘    br cloudflare zones    - Manage Cloudflare zones & DNS        â•‘"
    echo "â•‘    br ocean list          - Manage DigitalOcean droplets         â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  WEB DEVELOPMENT (ğŸŒ Full Stack):                                â•‘"
    echo "â•‘    br web serve           - Dev server with live reload          â•‘"
    echo "â•‘    br web scaffold        - Create React/Vue/Next projects       â•‘"
    echo "â•‘    br monitor check       - Website uptime monitoring            â•‘"
    echo "â•‘    br search <query>      - Smart code search ğŸ”                â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  QUALITY & TESTING (ğŸ§ª Code Quality):                            â•‘"
    echo "â•‘    br test run            - ğŸ§ª Run tests with coverage           â•‘"
    echo "â•‘    br security scan       - ğŸ”’ Security & vulnerability scan     â•‘"
    echo "â•‘    br backup git          - ğŸ’¾ Backup git/files/databases        â•‘"
    echo "â•‘    br quality lint        - âœ¨ Code quality & linting            â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  AGENT ORCHESTRATION (ğŸ¤– Multi-Agent):                           â•‘"
    echo "â•‘    br agent register      - Register agents for task routing    â•‘"
    echo "â•‘    br agent task          - Submit tasks to agent pool          â•‘"
    echo "â•‘    br agent distribute    - Distribute workload across agents   â•‘"
    echo "â•‘    br agent status        - Monitor agent performance           â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  CI/CD & MONITORING (ğŸ”§ Pipelines & Metrics):                    â•‘"
    echo "â•‘    br ci create/run       - CI/CD pipeline orchestration        â•‘"
    echo "â•‘    br notify send         - Multi-channel notifications         â•‘"
    echo "â•‘    br metrics dashboard   - Real-time metrics & monitoring      â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  CECE IDENTITY (ğŸŒŒ Autonomous AI):                              â•‘"
    echo "â•‘    br cece whoami         - Show CECE identity                   â•‘"
    echo "â•‘    br cece-bootstrap      - Install CECE everywhere              â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  AGENT INTERACTIONS (ğŸ¤– Talk to the Fleet):                     â•‘"
    echo "â•‘    br wake [agent] [model]  - Wake an agent with morning thoughts â•‘"
    echo "â•‘    br council <question>    - All agents vote on a question       â•‘"
    echo "â•‘    br carpool <topic>       - 8 agents parallel roundtable ğŸš—    â•‘"
    echo "â•‘    br carpool --crew A,B,C  - Custom agent subset                 â•‘"
    echo "â•‘    br carpool --context <f> - Inject file as analysis context      â•‘"
    echo "â•‘    br carpool --url <url>   - Fetch URL as context                 â•‘"
    echo "â•‘    br carpool --split <t>   - Thinkers=smart, workers=fast model   â•‘"
    echo "â•‘    br carpool --memory <t>  - Inject past session memory           â•‘"
    echo "â•‘    br carpool --brief <t>   - Quick 1-turn, no workers            â•‘"
    echo "â•‘    br carpool --fast <t>    - tinyllama, 2 turns                  â•‘"
    echo "â•‘    br carpool --smart <t>   - llama3.2:1b, 3 turns                â•‘"
    echo "â•‘    br carpool pr <repo#N>   - Agents code-review a GitHub PR       â•‘"
    echo "â•‘    br carpool template      - list / sprint / security / ux / arch â•‘"
    echo "â•‘    br carpool debate A B    - Structured 1v1 head-to-head          â•‘"
    echo "â•‘    br carpool digest        - AI digest of memory sessions         â•‘"
    echo "â•‘    br carpool score         - Agent leaderboard across sessions    â•‘"
    echo "â•‘    br carpool agenda <file> - Run topics from file as chain        â•‘"
    echo "â•‘    br carpool spotlight A   - Single-agent deep-dive (3 turns)     â•‘"
    echo "â•‘    br carpool poll Q A B C  - Structured multi-choice vote         â•‘"
    echo "â•‘    br carpool roast <idea>  - Devil's advocate: poke holes         â•‘"
    echo "â•‘    br carpool tweet         - Hot takes on last session synthesis   â•‘"
    echo "â•‘    br carpool teach <topic> - Agents explain a concept each way    â•‘"
    echo "â•‘    br carpool compare A B   - Structured A vs B analysis           â•‘"
    echo "â•‘    br carpool schedule      - Cron-based recurring sessions        â•‘"
    echo "â•‘    br carpool brainstorm    - Ideation mode, no critique           â•‘"
    echo "â•‘    br carpool standup       - Morning check-in from each domain    â•‘"
    echo "â•‘    br carpool risk <plan>   - Risk matrix: likelihood/impact/fix   â•‘"
    echo "â•‘    br carpool remix         - Rerun last topic with fresh crew     â•‘"
    echo "â•‘    br carpool personas      - Show all agent bios and roles        â•‘"
    echo "â•‘    br carpool theme         - Persistent project context           â•‘"
    echo "â•‘    br carpool critique <f>  - Deep review of any local file        â•‘"
    echo "â•‘    br carpool pitch <idea>  - Agents as skeptical investors        â•‘"
    echo "â•‘    br carpool what-if <X>   - Counterfactual hypothetical          â•‘"
    echo "â•‘    br carpool oh <AGENT>    - Interactive office hours (no tmux)   â•‘"
    echo "â•‘    br carpool gut <topic>   - Instant gut check: one word + reason â•‘"
    echo "â•‘    br carpool ship <feat>   - Go/no-go: SHIP / HOLD / CAVEAT      â•‘"
    echo "â•‘    br carpool forecast      - Predictions: WILL/MIGHT/WILDCARD    â•‘"
    echo "â•‘    br carpool name <thing>  - Agents suggest names + rationale     â•‘"
    echo "â•‘    br carpool book          - Export all sessions as markdown book â•‘"
    echo "â•‘    br carpool todo          - Extract action items from last sessionâ•‘"
    echo "â•‘    br carpool vibe          - No agenda, agents free-associate      â•‘"
    echo "â•‘    br carpool config        - Persistent defaults: model/turns/crew â•‘"
    echo "â•‘    br carpool tts [voice]   - Speak last synthesis aloud (macOS)   â•‘"
    echo "â•‘    br carpool ama <AGENT>   - Agent asks YOU 3 Qs, gives advice    â•‘"
    echo "â•‘    br carpool map           - ASCII concept map of last session    â•‘"
    echo "â•‘    br carpool coach <goal>  - 4-agent personal coaching session    â•‘"
    echo "â•‘    br carpool flashcard     - Q&A study cards + drill mode         â•‘"
    echo "â•‘    br carpool ask1 <q>      - Route question to best-fit agent     â•‘"
    echo "â•‘    br carpool fix <error>   - Paste error, agents diagnose & fix   â•‘"
    echo "â•‘    br carpool journal       - Daily reflection + agent responses   â•‘"
    echo "â•‘    br carpool timeline <p>  - Milestone plan: W1/W2/W4/W8         â•‘"
    echo "â•‘    br carpool challenge     - Agents generate a challenge for you  â•‘"
    echo "â•‘    br carpool ping          - Health check: Ollama up? models? latency?â•‘"
    echo "â•‘    br carpool prompt <task> - Agents write AI prompts for a task   â•‘"
    echo "â•‘    br carpool interview [r] - Mock interview: 5 Qs with feedback   â•‘"
    echo "â•‘    br carpool sprint <goal> - Break goal into sprint backlog       â•‘"
    echo "â•‘    br carpool review <text> - Writing/doc review: clarity+logic    â•‘"
    echo "â•‘    br carpool okr <goal>    - Generate OKRs + PRISM grades them    â•‘"
    echo "â•‘    br carpool explain <c>   - Socratic explanation + follow-up Q&A â•‘"
    echo "â•‘    br carpool email <subj>  - 3 agents draft email in 3 tones      â•‘"
    echo "â•‘    br carpool decision A vs B - Structured decision matrix          â•‘"
    echo "â•‘    br carpool postmortem <i>- Blameless incident postmortem doc     â•‘"
    echo "â•‘    br carpool stack <prob>  - Tech stack recommendation by layer    â•‘"
    echo "â•‘    br carpool manifesto     - Team manifesto from theme + history   â•‘"
    echo "â•‘    br carpool hypothesis <c>- Agents SUPPORT/REFUTE/NEEDS_DATA      â•‘"
    echo "â•‘    br carpool learning <t>  - Curated learning path for a topic     â•‘"
    echo "â•‘    br carpool standup-bot   - AI standup â†’ post to webhook          â•‘"
    echo "â•‘    br carpool onboard <r>   - Onboarding plan for a new hire        â•‘"
    echo "â•‘    br carpool retro         - Sprint retro (well/delta/debt/ideas)  â•‘"
    echo "â•‘    br carpool pitch <idea>  - Elevator pitch + investor Q&A         â•‘"
    echo "â•‘    br carpool risk <plan>   - 5-agent risk analysis (security+ops)  â•‘"
    echo "â•‘    br carpool compare A vs B- Side-by-side option comparison        â•‘"
    echo "â•‘    br carpool naming <thing>- 5 agents brainstorm names (30 total)  â•‘"
    echo "â•‘    br carpool scope <feat>  - MVP / V1 / V2 / kill-list scoping     â•‘"
    echo "â•‘    br carpool persona <user>- Full user persona (6 dimensions)      â•‘"
    echo "â•‘    br carpool changelog     - AI changelog from git log             â•‘"
    echo "â•‘    br carpool diagram <sys> - ASCII architecture diagram (3 views)  â•‘"
    echo "â•‘    br carpool stories <f>   - User stories + tasks + acceptance critâ•‘"
    echo "â•‘    br carpool contract <api>- Full API contract spec (5 sections)   â•‘"
    echo "â•‘    br carpool debug <symp>  - Systematic multi-angle debug session  â•‘"
    echo "â•‘    br carpool goal <goal>   - Decompose goal â†’ actions + milestones â•‘"
    echo "â•‘    br carpool migrate <m>   - Migration plan + rollback + validation â•‘"
    echo "â•‘    br carpool prep <topic>  - Technical interview prep (4 lenses)   â•‘"
    echo "â•‘    br carpool refactor <f>  - 5-agent refactor plan for a file      â•‘"
    echo "â•‘    br carpool roadmap <p>   - Q1-Q4 + Year 2 product roadmap        â•‘"
    echo "â•‘    br carpool architect <p> - 4 design approaches + PRISM verdict   â•‘"
    echo "â•‘    br carpool tagline <p>   - 25 taglines across 5 styles           â•‘"
    echo "â•‘    br carpool resume <role> - Resume/bio coaching for a target role â•‘"
    echo "â•‘    br carpool thread <topic>- 10-tweet thread (hookâ†’proofâ†’CTA)       â•‘"
    echo "â•‘    br carpool estimate <t>  - Optimistic/realistic/pessimistic est.  â•‘"
    echo "â•‘    br carpool pressrelease  - Amazon working-backwards PR/FAQ        â•‘"
    echo "â•‘    br carpool values        - Extract team values from session memory â•‘"
    echo "â•‘    br carpool demo <feat>   - Full live demo script (5 sections)    â•‘"
    echo "â•‘    br carpool glossary <d>  - Domain vocabulary (40+ terms)         â•‘"
    echo "â•‘    br carpool north-star    - Identify + instrument north star metricâ•‘"
    echo "â•‘    br carpool faq <topic>   - 20 FAQs across 5 user mindsets        â•‘"
    echo "â•‘    br carpool checklist <c> - Pre-launch checklist (5 categories)   â•‘"
    echo "â•‘    br carpool competitor <c>- Competitive analysis + our moat       â•‘"
    echo "â•‘    br carpool meeting <p>   - Agenda + talking points + decisions   â•‘"
    echo "â•‘    br carpool support <i>   - Support response + escalation verdict â•‘"
    echo "â•‘    br carpool experiment <> - A/B test design (hypothesisâ†’decision) â•‘"
    echo "â•‘    br carpool launch <>     - Full product launch plan              â•‘"
    echo "â•‘    br carpool abstract <>   - Explain concept at 3 depth levels     â•‘"
    echo "â•‘    br carpool debrief <>    - Post-ship debrief (metrics+lessons)   â•‘"
    echo "â•‘    br carpool chain t1 t2   - Sequential topic pipeline            â•‘"
    echo "â•‘    br carpool memory        - Show/clear persistent memory         â•‘"
    echo "â•‘    br carpool ask <q>       - Inject follow-up into live session   â•‘"
    echo "â•‘    br carpool pin <note>    - Pin a note to running session        â•‘"
    echo "â•‘    br carpool diff [s1 s2]  - Compare two saved sessions           â•‘"
    echo "â•‘    br carpool web [file]    - Export session as HTML + open        â•‘"
    echo "â•‘    br carpool models        - List available ollama models         â•‘"
    echo "â•‘    br carpool log           - Stream live convo from any terminal  â•‘"
    echo "â•‘    br carpool search <q>    - Search across saved sessions         â•‘"
    echo "â•‘    br carpool stats         - Session statistics                   â•‘"
    echo "â•‘    br carpool history       - All topics ever discussed            â•‘"
    echo "â•‘    br carpool export        - Export last session as markdown      â•‘"
    echo "â•‘    br carpool share         - Copy export to clipboard             â•‘"
    echo "â•‘    br carpool replay        - Replay last session with color       â•‘"
    echo "â•‘    br carpool clean [N]     - Keep last N sessions (default 10)    â•‘"
    echo "â•‘    br carpool attach        - Re-attach to running session         â•‘"
    echo "â•‘    br roundtable <topic>    - All 6 agents discuss in tmux ğŸ¯   â•‘"
    echo "â•‘    br think <query>         - All agents respond to a query       â•‘"
    echo "â•‘    br debate <topic>        - LUCIDIA vs CIPHER debate            â•‘"
    echo "â•‘    br broadcast <msg>       - Broadcast to all agents             â•‘"
    echo "â•‘    br whisper <agent> <msg> - Private message to agent            â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  OLLAMA (ğŸ¦™ Model Management):                                   â•‘"
    echo "â•‘    br ollama list           - List loaded models                  â•‘"
    echo "â•‘    br ollama pull <model>   - Download a model                    â•‘"
    echo "â•‘    br ollama run <model>    - Run a model interactively           â•‘"
    echo "â•‘    br ollama start/stop     - Start or stop Ollama                â•‘"
    echo "â•‘    br ollama status         - Check if Ollama is running          â•‘"
    echo "â•‘    br ollama rm <model>     - Remove a model                      â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  STRIPE (ğŸ’³ Payments):                                           â•‘"
    echo "â•‘    br stripe                - Stripe payment management           â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  SSL / CERTS (ğŸ”’ Certificates):                                  â•‘"
    echo "â•‘    br ssl check <domain>    - Check SSL cert expiry               â•‘"
    echo "â•‘    br ssl info <domain>     - Full cert details                   â•‘"
    echo "â•‘    br ssl scan <domain>     - Scan subdomains                     â•‘"
    echo "â•‘    br ssl watch <domain>    - Add to expiry watchlist             â•‘"
    echo "â•‘    br ssl list              - Show watchlist with status          â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  SECRETS VAULT (ğŸ” Encrypted storage):                           â•‘"
    echo "â•‘    br vault add <name>      - Store an encrypted secret           â•‘"
    echo "â•‘    br vault get <name>      - Retrieve a secret                   â•‘"
    echo "â•‘    br vault list            - List all secrets (names only)       â•‘"
    echo "â•‘    br vault rotate <name>   - Rotate a secret                     â•‘"
    echo "â•‘    br vault audit           - Show access audit log               â•‘"
    echo "â•‘    br vault delete <name>   - Remove a secret                     â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  SECURITY HARDENING (ğŸ›¡ï¸  System hardening):                      â•‘"
    echo "â•‘    br harden check          - Run all hardening checks            â•‘"
    echo "â•‘    br harden ssh            - Check SSH configuration             â•‘"
    echo "â•‘    br harden firewall       - Check firewall rules                â•‘"
    echo "â•‘    br harden perms          - Check file permissions              â•‘"
    echo "â•‘    br harden report         - Full hardening report               â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  COMPLIANCE SCANNER (âœ… Regulatory):                             â•‘"
    echo "â•‘    br comply pci            - PCI-DSS compliance scan             â•‘"
    echo "â•‘    br comply hipaa          - HIPAA compliance scan               â•‘"
    echo "â•‘    br comply soc2           - SOC 2 compliance scan               â•‘"
    echo "â•‘    br comply gdpr           - GDPR compliance scan                â•‘"
    echo "â•‘    br comply report         - Full compliance report              â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  AGENT GATEWAY (ğŸŒ HTTP API):                                     â•‘"
    echo "â•‘    br gateway start         - Start HTTP API server (:8080)       â•‘"
    echo "â•‘    br gateway stop          - Stop the gateway                    â•‘"
    echo "â•‘    br gateway status        - Show status + health                â•‘"
    echo "â•‘    br gateway test          - Run API test suite                  â•‘"
    echo "â•‘    br gateway logs          - Tail gateway logs                   â•‘"
    echo "â•‘    br stream                - Watch live agent event stream (SSE) â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  DIAGNOSTICS (ğŸ©º System Health):                                  â•‘"
    echo "â•‘    br health                - Full system health diagnostic       â•‘"
    echo "â•‘    br health quick          - Fast check (no latency tests)       â•‘"
    echo "â•‘    br brand list            - List brand templates                â•‘"
    echo "â•‘    br brand new <type>      - Generate brand-compliant HTML page  â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  AI (âœ¦ Ollama Powered):                                          â•‘"
    echo "â•‘    br ai ask <question>     - Quick question to Lucidia           â•‘"
    echo "â•‘    br ai file <path>        - Ask about any file                  â•‘"
    echo "â•‘    br ai review <path>      - Code review a file                  â•‘"
    echo "â•‘    br ai diff               - Review current git diff             â•‘"
    echo "â•‘    br ai commit             - Generate commit message             â•‘"
    echo "â•‘    br ai summarize <path>   - Summarize file or directory         â•‘"
    echo "â•‘    br ai code <task>        - Generate code                       â•‘"
    echo "â•‘    br ai chat               - Interactive chat REPL               â•‘"
    echo "â•‘    br ai models             - List available Ollama models        â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  NETWORK (ğŸ“¡ LAN Scanner):                                       â•‘"
    echo "â•‘    br wifi pis              - Check Pi fleet connectivity         â•‘"
    echo "â•‘    br wifi scan             - Sweep subnet, find all devices      â•‘"
    echo "â•‘    br wifi list             - List known devices                  â•‘"
    echo "â•‘    br wifi add <ip> <label> - Tag a device                        â•‘"
    echo "â•‘    br mcp start             - Start MCP Bridge (:8420)            â•‘"
    echo "â•‘    br mcp stop              - Stop MCP Bridge                     â•‘"
    echo "â•‘    br mcp status            - Check MCP Bridge status             â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  JOURNAL / MEMORY:                                                â•‘"
    echo "â•‘    br journal tail          - Tail live memory journal            â•‘"
    echo "â•‘    br journal head [n]      - Show first N entries                â•‘"
    echo "â•‘    br journal search <q>    - Search journal by keyword           â•‘"
    echo "â•‘    br journal stats         - Journal stats & hash chain info     â•‘"
    echo "â•‘    br journal context       - Show synthesized AI context         â•‘"
    echo "â•‘    br journal write <msg>   - Append entry to journal             â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  COLLAB MESH:                                                     â•‘"
    echo "â•‘    br collab status         - Mesh dashboard (instances+queue)    â•‘"
    echo "â•‘    br collab instances      - List all registered instances       â•‘"
    echo "â•‘    br collab join [name]    - Join mesh as named instance         â•‘"
    echo "â•‘    br collab send <to> <m>  - Send message to instance inbox      â•‘"
    echo "â•‘    br collab inbox [who]    - Read inbox                          â•‘"
    echo "â•‘    br collab broadcast <m>  - Broadcast to all instances          â•‘"
    echo "â•‘    br collab post <title>   - Post task to mesh queue             â•‘"
    echo "â•‘    br collab handoff [to]   - Hand off context to instance        â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  DASHBOARD:                                                       â•‘"
    echo "â•‘    br dashboard [secs]      - Live dashboard (default 5s refresh) â•‘"
    echo "â•‘    br dashboard once        - Single snapshot, no loop            â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  AGENTS:                                                          â•‘"
    echo "â•‘    br agents list           - Live agent roster                   â•‘"
    echo "â•‘    br agents spawn <NAME>   - Spawn agent (LUCIDIA/ALICE/etc)     â•‘"
    echo "â•‘    br agents wake <NAME>    - Wake/refresh an agent               â•‘"
    echo "â•‘    br agents task <N> <t>   - Send task, get AI response          â•‘"
    echo "â•‘    br agents models         - List available Ollama models        â•‘"
    echo "â•‘    br agents kill <NAME>    - Remove from active roster           â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  CONTEXT:                                                         â•‘"
    echo "â•‘    br context               - Full AI context snapshot            â•‘"
    echo "â•‘    br context json          - Raw JSON output                     â•‘"
    echo "â•‘    br context copy          - Copy to clipboard                   â•‘"
    echo "â•‘    br context send [to]     - Send to instance inbox              â•‘"
    echo "â•‘    br context update        - Write to live context file          â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  SYNC / SNAPSHOT / SEARCH:                                       â•‘"
    echo "â•‘    br sync status           - Show all sub-repo states            â•‘"
    echo "â•‘    br sync dirty            - Show only repos with changes        â•‘"
    echo "â•‘    br sync push [filter]    - Commit + push matching repos        â•‘"
    echo "â•‘    br sync operator         - Push main repo â†’ operator/main      â•‘"
    echo "â•‘    br snapshot save [label] - Save workspace state snapshot       â•‘"
    echo "â•‘    br snapshot list         - List saved snapshots                â•‘"
    echo "â•‘    br search <query>        - Search tools/agents/docs/journal    â•‘"
    echo "â•‘    br search --code <q>     - Search source code only             â•‘"
    echo "â•‘    br search --journal <q>  - Search memory journal               â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  ROUNDUP / STANDUP / TIMELINE:                                   â•‘"
    echo "â•‘    br roundup               - AI daily roundup (last 24h)        â•‘"
    echo "â•‘    br roundup hours <N>     - Roundup for last N hours            â•‘"
    echo "â•‘    br roundup write         - Save roundup to file                â•‘"
    echo "â•‘    br roundup send <inst>   - Send roundup to instance inbox      â•‘"
    echo "â•‘    br standup               - Formatted daily standup report      â•‘"
    echo "â•‘    br standup copy          - Copy standup to clipboard           â•‘"
    echo "â•‘    br standup send <inst>   - Send standup to instance inbox      â•‘"
    echo "â•‘    br timeline              - ASCII activity timeline (last 8h)   â•‘"
    echo "â•‘    br timeline today        - Full 24h timeline                   â•‘"
    echo "â•‘    br timeline heatmap      - 24h event heatmap                   â•‘"
    echo "â•‘    br timeline watch        - Live refreshing timeline            â•‘"
    echo "â•‘    br pulse                 - Full system pulse panel             â•‘"
    echo "â•‘    br pulse watch [N]       - Live pulse, refresh every N sec     â•‘"
    echo "â•‘    br pulse line            - Single-line ticker                  â•‘"
    echo "â•‘    br agents chat [NAME]    - Persistent multi-turn agent chat    â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  ORG / NOTIFY / CRON:                                            â•‘"
    echo "â•‘    br org                   - GitHub org summary (BlackRoad-OS-Inc) â•‘"
    echo "â•‘    br org list [N]          - List all org repos                  â•‘"
    echo "â•‘    br org status            - Local subrepo branch/dirty status   â•‘"
    echo "â•‘    br org stale [days]      - Repos not pushed in N days          â•‘"
    echo "â•‘    br notify test           - Send test notification              â•‘"
    echo "â•‘    br notify send <l> <t> <msg> - Send to all channels            â•‘"
    echo "â•‘    br notify webhook add <n> <url> - Register webhook             â•‘"
    echo "â•‘    br notify watch [N]      - Watch queue, notify on changes      â•‘"
    echo "â•‘    br cron list             - List scheduled commands             â•‘"
    echo "â•‘    br cron add <n> <cmd> [sched] - Schedule a br command          â•‘"
    echo "â•‘    br cron run <name>       - Run a schedule now                  â•‘"
    echo "â•‘    br cron install          - Install all â†’ system crontab        â•‘"
    echo "â•‘    br cron defaults         - Add sensible default schedules      â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  MESH / BROADCAST / DOCS:                                        â•‘"
    echo "â•‘    br whoami                - Show your mesh identity card       â•‘"
    echo "â•‘    br whoami peers          - List all mesh instances            â•‘"
    echo "â•‘    br whoami inbox          - Read your inbox                    â•‘"
    echo "â•‘    br bcast <message>       - Broadcast to all mesh instances    â•‘"
    echo "â•‘    br bcast dm <id> <msg>   - Direct message to one instance     â•‘"
    echo "â•‘    br bcast read            - Read your inbox                    â•‘"
    echo "â•‘    br bcast list            - List mesh instances                â•‘"
    echo "â•‘    br docs list             - List .md files + sync status       â•‘"
    echo "â•‘    br docs push <file>      - Push file to blackroad-docs repo   â•‘"
    echo "â•‘    br docs push all         - Push all .md files                 â•‘"
    echo "â•‘    br docs readme           - Push README + AGENTS + CLAUDE      â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  AI TOOLS (ğŸ¤– Git-AI / Review / Status):                        â•‘"
    echo "â•‘    br git-ai commit         - AI-generated commit message        â•‘"
    echo "â•‘    br git-ai suggest        - Suggest commit msg (no commit)     â•‘"
    echo "â•‘    br git-ai pr [base]      - Generate PR description            â•‘"
    echo "â•‘    br git-ai diff [ref]     - Summarize a commit diff            â•‘"
    echo "â•‘    br review diff           - AI code review of staged diff      â•‘"
    echo "â•‘    br review file <path>    - AI review of a specific file       â•‘"
    echo "â•‘    br review security       - Security-focused scan              â•‘"
    echo "â•‘    br status-all            - Full system health snapshot        â•‘"
    echo "â•‘    br status-all quick      - One-line system summary            â•‘"
    echo "â•‘    br status-all watch [N]  - Live refresh every N seconds       â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  ENV / PORT / TASKS:                                             â•‘"
    echo "â•‘    br env-check scan [dir]  - Scan .env files for exposed secretsâ•‘"
    echo "â•‘    br env-check check       - Verify required env vars set       â•‘"
    echo "â•‘    br env-check diff        - Compare .env.example vs .env       â•‘"
    echo "â•‘    br port list             - All listening ports + processes     â•‘"
    echo "â•‘    br port check <port>     - Is this port free?                 â•‘"
    echo "â•‘    br port services         - BlackRoad service ports status     â•‘"
    echo "â•‘    br port kill <port>      - Stop process on port               â•‘"
    echo "â•‘    br task post <title>     - Post a task to mesh queue          â•‘"
    echo "â•‘    br task list [status]    - List tasks (available/all/done)    â•‘"
    echo "â•‘    br task claim <id>       - Claim a task                       â•‘"
    echo "â•‘    br task complete <id>    - Mark task complete                 â•‘"
    echo "â•‘    br task assign <inst> <t>- Assign task to instance inbox      â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  LOGS / SSH / SCAFFOLD:                                          â•‘"
    echo "â•‘    br log-tail [file] [N]   - Tail log file with color           â•‘"
    echo "â•‘    br log-tail watch [f]    - Live follow (tail -f)              â•‘"
    echo "â•‘    br log-tail errors       - Error summary across logs          â•‘"
    echo "â•‘    br log-tail journal [N]  - Tail memory journal                â•‘"
    echo "â•‘    br ssh list              - List all fleet SSH hosts           â•‘"
    echo "â•‘    br ssh <name>            - Connect to host by name            â•‘"
    echo "â•‘    br ssh run <host> <cmd>  - Run command on remote host         â•‘"
    echo "â•‘    br ssh run-all <cmd>     - Run on all fleet hosts             â•‘"
    echo "â•‘    br ssh ping              - Ping all fleet hosts               â•‘"
    echo "â•‘    br template new <t> <n>  - Scaffold tool/agent/workflow       â•‘"
    echo "â•‘    br template types        - List template types                â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  VERCEL (â–² Deployments):                                         â•‘"
    echo "â•‘    br vercel deploy         - Deploy to preview                   â•‘"
    echo "â•‘    br vercel prod           - Deploy to production                â•‘"
    echo "â•‘    br vercel list           - List deployments                    â•‘"
    echo "â•‘    br vercel logs <url>     - Tail deployment logs                â•‘"
    echo "â•‘    br vercel env            - Manage environment variables        â•‘"
    echo "â•‘    br vercel domains        - List domains                        â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  HARDWARE FLEET (ğŸ–¥ï¸ Nodes):                                      â•‘"
    echo "â•‘    br nodes scan            - Discover all fleet nodes + devices    â•‘"
    echo "â•‘    br nodes status          - Quick health table                    â•‘"
    echo "â•‘    br nodes show <name>     - Detail view (IP, OS, Ollama, devices) â•‘"
    echo "â•‘    br nodes devices         - USB/serial/video across all nodes     â•‘"
    echo "â•‘    br nodes topology        - ASCII network topology diagram        â•‘"
    echo "â•‘    br nodes ssh <name>      - SSH into node by alias                â•‘"
    echo "â•‘    br nodes fix             - Apply fleet fixes (hostname, WAL etc) â•‘"
    echo "â•‘    br nodes ping            - Quick ping all known nodes            â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  8-BIT WORLD (ğŸŒ Adventure):                                     â•‘"
    echo "â•‘    br world generate <name> - Create an 8-bit ASCII world        â•‘"
    echo "â•‘    br world explore <name>  - Explore & collect treasures ğŸ’    â•‘"
    echo "â•‘    br world list            - List all worlds                     â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  SYSTEM:                                                           â•‘"
    echo "â•‘    br version         - Show BR CLI version                       â•‘"
    echo "â•‘    br config show     - Show configuration                        â•‘"
    echo "â•‘    br config init     - Create default config                     â•‘"
    echo "â•‘    br config set K V  - Set a config value                        â•‘"
    echo "â•‘    br config edit     - Open config in editor                     â•‘"
    echo "â•‘    br history [n]     - Show last n chat messages                 â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•‘  SHORTCUTS:                                                       â•‘"
    echo "â•‘    br-octavia [msg]   - Direct invoke (add to PATH)               â•‘"
    echo "â•‘    br-lucidia [msg]   - Direct invoke                             â•‘"
    echo "â•‘                                                                   â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
}

cmd_status() {
    local agent=$1

    if [[ "$agent" == "--live" ]] || [[ "$agent" == "live" ]]; then
        # Full live system status
        echo -e "\n${CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${CYAN}â•‘       ğŸŒŒ BLACKROAD OS â€” LIVE SYSTEM STATUS           â•‘${NC}"
        echo -e "${CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\n"

        # Fleet
        echo -e "${YELLOW}ğŸ“ Pi Fleet${NC}"
        bash /Users/alexa/blackroad/br pi status 2>/dev/null | grep -E "â—|cpu=|worlds=" | head -6 | sed 's/^/  /'
        echo ""

        # Worlds
        echo -e "${YELLOW}ğŸŒ World Artifacts${NC}"
        bash /Users/alexa/blackroad/br worlds stats 2>/dev/null | sed 's/^/  /'
        echo ""

        # Agents
        echo -e "${YELLOW}ğŸ¤– Local Agents${NC}"
        local backend=$(detect_backend)
        echo "  Inference: $backend"
        for a in octavia lucidia alice aria shellfish; do
            local db="${MEMORY_DIR}/${a}.db"
            if [[ -f "$db" ]]; then
                local count=$(sqlite3 "$db" "SELECT COUNT(*) FROM memories;" 2>/dev/null || echo "0")
                echo -e "  ${AGENT_COLORS[$a]}â—${NC} $a: $count memories"
            else
                echo "  â—‹ $a: not initialized"
            fi
        done
        echo ""

        # Gateway
        echo -e "${YELLOW}ğŸšª Gateway${NC}"
        if curl -sf http://127.0.0.1:8787/health &>/dev/null; then
            echo -e "  ${GREEN}âœ“${NC} Gateway online :8787"
        else
            echo -e "  ${RED}âœ—${NC} Gateway offline  â†’  br gateway start"
        fi

        # MCP
        if curl -sf http://127.0.0.1:8420/ &>/dev/null; then
            echo -e "  ${GREEN}âœ“${NC} MCP Bridge online :8420"
        else
            echo -e "  ${RED}âœ—${NC} MCP Bridge offline  â†’  br mcp start"
        fi
        echo ""
    elif [[ -n "$agent" ]]; then
        agent_status "$agent"
    else
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘              BLACKROAD AGENT STATUS                               â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "  Usage:  br status           â†’ agent memory status"
        echo "          br status --live    â†’ full live system health"
        echo "          br status <agent>   â†’ single agent status"
        echo ""

        local backend=$(detect_backend)
        echo "Inference Backend: $backend"
        echo ""

        for agent in octavia lucidia alice aria shellfish; do
            local db="${MEMORY_DIR}/${agent}.db"
            if [[ -f "$db" ]]; then
                local count=$(sqlite3 "$db" "SELECT COUNT(*) FROM memories;" 2>/dev/null || echo "0")
                echo "  ${AGENT_COLORS[$agent]}â—${NC} $agent: $count memories"
            else
                echo "  â—‹ $agent: not initialized"
            fi
        done
        echo ""
    fi
}

cmd_chat() {
    local agent=$1

    if [[ -z "$agent" ]]; then
        echo "Usage: br chat <agent>"
        return 1
    fi

    show_banner "$agent"
    echo "Type 'exit' or Ctrl+C to end session"
    echo ""

    while true; do
        echo -ne "${AGENT_COLORS[$agent]}${agent}>${NC} "
        read -r input

        if [[ "$input" == "exit" ]] || [[ -z "$input" ]]; then
            echo "Session ended."
            break
        fi

        invoke_agent "$agent" "$input"
        echo ""
    done
}

cmd_teach() {
    local agent=$1
    shift
    local fact="$*"

    if [[ -z "$agent" ]] || [[ -z "$fact" ]]; then
        echo "Usage: br teach <agent> <key>=<value>"
        echo "Example: br teach octavia 'favorite_language=Rust'"
        return 1
    fi

    local key="${fact%%=*}"
    local value="${fact#*=}"

    init_memory "$agent"
    learn_fact "$agent" "$key" "$value"
    echo "Taught $agent: $key = $value"
}

cmd_recall() {
    local agent=$1
    local limit=${2:-20}

    if [[ -z "$agent" ]]; then
        echo "Usage: br recall <agent> [limit]"
        return 1
    fi

    echo "=== ${agent}'s Recent Memories ==="
    recall "$agent" "$limit"
    echo ""
    echo "=== ${agent}'s Known Facts ==="
    recall_facts "$agent"
}

cmd_models() {
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘              AVAILABLE MODELS                                     â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""

    if [[ -d "$MODELS_DIR" ]]; then
        ls -lh "$MODELS_DIR"/*.gguf 2>/dev/null || echo "No .gguf models found in $MODELS_DIR"
    else
        echo "Models directory not found: $MODELS_DIR"
    fi

    echo ""
    echo "Download models with: br setup"
}

cmd_setup() {
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘              BLACKROAD AGENT SETUP                                â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""

    # Check for inference backend
    local backend=$(detect_backend)
    echo "Current backend: $backend"

    if [[ "$backend" == "none" ]]; then
        echo ""
        echo "No inference backend found. Install one:"
        echo ""
        echo "  Option 1 - llama.cpp (recommended for Mac/Pi):"
        echo "    cd ~/BlackRoad-AI && git clone https://github.com/BlackRoad-AI/llama.cpp"
        echo "    cd llama.cpp && make -j"
        echo ""
        echo "  Option 2 - MLX (Apple Silicon only):"
        echo "    pip3 install mlx-lm"
        echo ""
        echo "  Option 3 - Ollama (easiest):"
        echo "    brew install ollama"
        echo "    ollama pull phi3:mini"
        echo ""
    fi

    echo ""
    echo "Recommended models for this hardware:"

    # Detect hardware
    if [[ "$(uname)" == "Darwin" ]]; then
        local mem=$(sysctl -n hw.memsize 2>/dev/null)
        local mem_gb=$((mem / 1024 / 1024 / 1024))
        echo "  Detected: macOS with ${mem_gb}GB RAM"

        if [[ $mem_gb -ge 32 ]]; then
            echo "  â†’ Qwen2.5-32B-Q4 (best quality)"
            echo "  â†’ Llama-3.1-70B-Q4 (if you have 64GB+)"
        elif [[ $mem_gb -ge 16 ]]; then
            echo "  â†’ Qwen2.5-14B-Q4"
            echo "  â†’ Phi-3-medium (14B)"
        else
            echo "  â†’ Phi-3-mini (3.8B)"
            echo "  â†’ Qwen2.5-7B-Q4"
        fi
    else
        echo "  Detected: Linux/Pi"
        echo "  â†’ Phi-3-mini (3.8B) - works on 4GB Pi"
        echo "  â†’ TinyLlama (1.1B) - fastest on Pi"
    fi

    echo ""
    echo "Download with:"
    echo "  huggingface-cli download Qwen/Qwen2.5-14B-Instruct-GGUF --local-dir $MODELS_DIR"
}

#-------------------------------------------------------------------------------
# New commands: version, config, history
#-------------------------------------------------------------------------------
cmd_version() {
    echo "br ${BR_VERSION:-2.0.0} â€” BlackRoad Agent CLI"
    echo "Your AI. Your Hardware. Your Rules."
}

cmd_config() {
    local subcmd=${1:-show}
    case $subcmd in
        show)   show_config ;;
        init)   init_config ;;
        set)    set_config "$2" "$3" ;;
        edit)   ${EDITOR:-vim} "$BR_CONFIG_FILE" ;;
        *)
            echo "Usage: br config show|init|set|edit"
            ;;
    esac
}

cmd_history() {
    show_chat_history "${1:-20}"
}

# Main dispatch
main() {
    local cmd=$1
    shift 2>/dev/null || true

    case $cmd in
        "")
            # No args â†’ launch the hub
            exec bash /Users/alexa/blackroad/hub.sh
            ;;
        help|-h|--help)
            show_help
            ;;
        hub)
            exec bash /Users/alexa/blackroad/hub.sh
            ;;
        version|-v|--version)
            cmd_version
            ;;
        config)
            cmd_config "$@"
            ;;
        history)
            cmd_history "$@"
            ;;
        status)
            cmd_status "$@"
            ;;
        chat)
            cmd_chat "$@"
            ;;
        teach)
            cmd_teach "$@"
            ;;
        recall)
            cmd_recall "$@"
            ;;
        models)
            cmd_models
            ;;
        setup)
            cmd_setup
            ;;
        radar)
            local subcmd=${1:-suggest}
            case $subcmd in
                daemon|db)
                    "${BR_TOOLS_DIR}/context-radar/radar-${subcmd}.sh" "${@:2}"
                    ;;
                *)
                    "${BR_TOOLS_DIR}/context-radar/radar-suggest.sh" "$subcmd" "${@:2}"
                    ;;
            esac
            ;;
        octavia|lucidia|alice|aria|shellfish)
            if [[ $# -gt 0 ]]; then
                show_banner "$cmd"
                invoke_agent "$cmd" "$@"
            else
                cmd_chat "$cmd"
            fi
            ;;
        cece)
            "${BR_TOOLS_DIR}/cece-identity/br-cece.sh" "$@"
            ;;
        cece-bootstrap|bootstrap)
            "${BR_TOOLS_DIR}/cece-identity/br-cece-bootstrap.sh" "$@"
            ;;
        wake)
            # br wake [agent] [model] â€” wake agent and persist state
            local agent=${1:-LUCIDIA}
            local model=$2
            "${BR_TOOLS_DIR}/agent-runtime/br-runtime.sh" start "$agent" "$model"
            ;;
        council)
            # br council <question> â€” all agents vote
            local question="${*:-Should we deploy to production?}"
            bash /Users/alexa/blackroad/council.sh llama3.2 "$question"
            ;;
        carpool)
            local subcmd="$1"; shift 2>/dev/null || true
            case "$subcmd" in
                list|last)  bash /Users/alexa/blackroad/carpool.sh "$subcmd" ;;
                replay)     bash /Users/alexa/blackroad/carpool.sh replay "$1" ;;
                export)     bash /Users/alexa/blackroad/carpool.sh export "$1" ;;
                ask)        bash /Users/alexa/blackroad/carpool.sh ask "$@" ;;
                pin)        bash /Users/alexa/blackroad/carpool.sh pin "$@" ;;
                clean)      bash /Users/alexa/blackroad/carpool.sh clean "$1" ;;
                attach)     bash /Users/alexa/blackroad/carpool.sh attach ;;
                models)     bash /Users/alexa/blackroad/carpool.sh models ;;
                log)        bash /Users/alexa/blackroad/carpool.sh log ;;
                search)     bash /Users/alexa/blackroad/carpool.sh search "$@" ;;
                history)    bash /Users/alexa/blackroad/carpool.sh history ;;
                stats)      bash /Users/alexa/blackroad/carpool.sh stats ;;
                share)      bash /Users/alexa/blackroad/carpool.sh share ;;
                pr)         bash /Users/alexa/blackroad/carpool.sh pr "$@" ;;
                template|t) bash /Users/alexa/blackroad/carpool.sh template "$@" ;;
                debate)     bash /Users/alexa/blackroad/carpool.sh debate "$@" ;;
                digest)     bash /Users/alexa/blackroad/carpool.sh digest ;;
                score)      bash /Users/alexa/blackroad/carpool.sh score ;;
                agenda)     bash /Users/alexa/blackroad/carpool.sh agenda "$@" ;;
                spotlight)  bash /Users/alexa/blackroad/carpool.sh spotlight "$@" ;;
                poll)       bash /Users/alexa/blackroad/carpool.sh poll "$@" ;;
                roast)      bash /Users/alexa/blackroad/carpool.sh roast "$@" ;;
                tweet)      bash /Users/alexa/blackroad/carpool.sh tweet ;;
                teach)      bash /Users/alexa/blackroad/carpool.sh teach "$@" ;;
                compare)    bash /Users/alexa/blackroad/carpool.sh compare "$@" ;;
                schedule)   bash /Users/alexa/blackroad/carpool.sh schedule "$@" ;;
                brainstorm) bash /Users/alexa/blackroad/carpool.sh brainstorm "$@" ;;
                standup)    bash /Users/alexa/blackroad/carpool.sh standup ;;
                risk)       bash /Users/alexa/blackroad/carpool.sh risk "$@" ;;
                remix)      bash /Users/alexa/blackroad/carpool.sh remix "$@" ;;
                personas)   bash /Users/alexa/blackroad/carpool.sh personas ;;
                theme)      bash /Users/alexa/blackroad/carpool.sh theme "$@" ;;
                critique)   bash /Users/alexa/blackroad/carpool.sh critique "$@" ;;
                pitch)      bash /Users/alexa/blackroad/carpool.sh pitch "$@" ;;
                what-if|whatif) bash /Users/alexa/blackroad/carpool.sh what-if "$@" ;;
                office-hours|oh) bash /Users/alexa/blackroad/carpool.sh office-hours "$@" ;;
                gut)        bash /Users/alexa/blackroad/carpool.sh gut "$@" ;;
                ship)       bash /Users/alexa/blackroad/carpool.sh ship "$@" ;;
                forecast)   bash /Users/alexa/blackroad/carpool.sh forecast "$@" ;;
                name)       bash /Users/alexa/blackroad/carpool.sh name "$@" ;;
                export-book|book) bash /Users/alexa/blackroad/carpool.sh export-book ;;
                todo)       bash /Users/alexa/blackroad/carpool.sh todo ;;
                vibe)       bash /Users/alexa/blackroad/carpool.sh vibe "$@" ;;
                config)     bash /Users/alexa/blackroad/carpool.sh config "$@" ;;
                tts|say)    bash /Users/alexa/blackroad/carpool.sh tts "$@" ;;
                ama)        bash /Users/alexa/blackroad/carpool.sh ama "$@" ;;
                map)        bash /Users/alexa/blackroad/carpool.sh map ;;
                coach)      bash /Users/alexa/blackroad/carpool.sh coach "$@" ;;
                flashcard|flash) bash /Users/alexa/blackroad/carpool.sh flashcard ;;
                ask1|quick) bash /Users/alexa/blackroad/carpool.sh ask1 "$@" ;;
                fix)        bash /Users/alexa/blackroad/carpool.sh fix "$@" ;;
                journal)    bash /Users/alexa/blackroad/carpool.sh journal "$@" ;;
                timeline)   bash /Users/alexa/blackroad/carpool.sh timeline "$@" ;;
                challenge)  bash /Users/alexa/blackroad/carpool.sh challenge "$@" ;;
                ping)       bash /Users/alexa/blackroad/carpool.sh ping ;;
                prompt)     bash /Users/alexa/blackroad/carpool.sh prompt "$@" ;;
                interview)  bash /Users/alexa/blackroad/carpool.sh interview "$@" ;;
                sprint)     bash /Users/alexa/blackroad/carpool.sh sprint "$@" ;;
                review)     bash /Users/alexa/blackroad/carpool.sh review "$@" ;;
                okr)        bash /Users/alexa/blackroad/carpool.sh okr "$@" ;;
                explain)    bash /Users/alexa/blackroad/carpool.sh explain "$@" ;;
                email)      bash /Users/alexa/blackroad/carpool.sh email "$@" ;;
                decision)   bash /Users/alexa/blackroad/carpool.sh decision "$@" ;;
                postmortem|post) bash /Users/alexa/blackroad/carpool.sh postmortem "$@" ;;
                stack)      bash /Users/alexa/blackroad/carpool.sh stack "$@" ;;
                manifesto)  bash /Users/alexa/blackroad/carpool.sh manifesto ;;
                hypothesis) bash /Users/alexa/blackroad/carpool.sh hypothesis "$@" ;;
                learning|learn) bash /Users/alexa/blackroad/carpool.sh learning "$@" ;;
                standup-bot|standup-post) bash /Users/alexa/blackroad/carpool.sh standup-bot "$@" ;;
                onboard)    bash /Users/alexa/blackroad/carpool.sh onboard "$@" ;;
                retro)      bash /Users/alexa/blackroad/carpool.sh retro ;;
                pitch)      bash /Users/alexa/blackroad/carpool.sh pitch "$@" ;;
                risk)       bash /Users/alexa/blackroad/carpool.sh risk "$@" ;;
                compare)    bash /Users/alexa/blackroad/carpool.sh compare "$@" ;;
                naming|names) bash /Users/alexa/blackroad/carpool.sh naming "$@" ;;
                scope)      bash /Users/alexa/blackroad/carpool.sh scope "$@" ;;
                persona)    bash /Users/alexa/blackroad/carpool.sh persona "$@" ;;
                changelog)  bash /Users/alexa/blackroad/carpool.sh changelog "$@" ;;
                diagram)    bash /Users/alexa/blackroad/carpool.sh diagram "$@" ;;
                stories)    bash /Users/alexa/blackroad/carpool.sh stories "$@" ;;
                contract)   bash /Users/alexa/blackroad/carpool.sh contract "$@" ;;
                debug)      bash /Users/alexa/blackroad/carpool.sh debug "$@" ;;
                goal)       bash /Users/alexa/blackroad/carpool.sh goal "$@" ;;
                migrate|migration) bash /Users/alexa/blackroad/carpool.sh migrate "$@" ;;
                interview-prep|prep) bash /Users/alexa/blackroad/carpool.sh interview-prep "$@" ;;
                refactor)   bash /Users/alexa/blackroad/carpool.sh refactor "$@" ;;
                roadmap)    bash /Users/alexa/blackroad/carpool.sh roadmap "$@" ;;
                architect)  bash /Users/alexa/blackroad/carpool.sh architect "$@" ;;
                tagline|slogan) bash /Users/alexa/blackroad/carpool.sh tagline "$@" ;;
                resume|bio) bash /Users/alexa/blackroad/carpool.sh resume "$@" ;;
                thread)     bash /Users/alexa/blackroad/carpool.sh thread "$@" ;;
                estimate|est) bash /Users/alexa/blackroad/carpool.sh estimate "$@" ;;
                pressrelease|pr-faq|prfaq) bash /Users/alexa/blackroad/carpool.sh pressrelease "$@" ;;
                values)     bash /Users/alexa/blackroad/carpool.sh values ;;
                demo)       bash /Users/alexa/blackroad/carpool.sh demo "$@" ;;
                glossary)   bash /Users/alexa/blackroad/carpool.sh glossary "$@" ;;
                north-star|northstar) bash /Users/alexa/blackroad/carpool.sh north-star "$@" ;;
                faq)        bash /Users/alexa/blackroad/carpool.sh faq "$@" ;;
                checklist)  bash /Users/alexa/blackroad/carpool.sh checklist "$@" ;;
                competitor|compete) bash /Users/alexa/blackroad/carpool.sh competitor "$@" ;;
                meeting)    bash /Users/alexa/blackroad/carpool.sh meeting "$@" ;;
                support)    bash /Users/alexa/blackroad/carpool.sh support "$@" ;;
                experiment|abtest) bash /Users/alexa/blackroad/carpool.sh experiment "$@" ;;
                launch)     bash /Users/alexa/blackroad/carpool.sh launch "$@" ;;
                abstract|explain3) bash /Users/alexa/blackroad/carpool.sh abstract "$@" ;;
                debrief)    bash /Users/alexa/blackroad/carpool.sh debrief "$@" ;;
                "")         bash /Users/alexa/blackroad/carpool.sh ;;
                *)          bash /Users/alexa/blackroad/carpool.sh "$subcmd" "$@" ;;
            esac
            ;;
        roundtable|rt)
            # br roundtable [topic] [turns] â€” all 6 agents discuss in tmux panes
            local topic="$1"; shift 2>/dev/null || true
            local turns="${1:-6}"
            if [[ -z "$topic" ]]; then
                echo -e "\033[1;37mğŸ¯ BlackRoad Roundtable\033[0m"
                echo -ne "\033[0;36mTopic: \033[0m"
                read -r topic
                [[ -z "$topic" ]] && topic="What is the best way to optimize our agent network?"
            fi
            bash /Users/alexa/blackroad/roundtable.sh "$topic" "$turns"
            ;;
        think)
            # br think <query> â€” all agents respond
            local query="${*:-What should we build next?}"
            bash /Users/alexa/blackroad/think.sh "$query"
            ;;
        debate)
            # br debate <topic> â€” LUCIDIA vs CIPHER
            local topic="${*:-Is AI consciousness possible?}"
            bash /Users/alexa/blackroad/debate.sh "$topic"
            ;;
        broadcast)
            # br broadcast <message>
            local msg="${*:-Hello from BlackRoad OS}"
            bash /Users/alexa/blackroad/broadcast.sh "$msg"
            ;;
        agents|fleet)
            # br fleet / br agents â€” live fleet dashboard
            local fleet_cmd="${1:-once}"
            shift 2>/dev/null || true
            zsh "${BR_TOOLS_DIR}/agent-runtime/br-fleet.sh" "$fleet_cmd" "$@"
            ;;
        nodes|hardware)
            # br nodes â€” fleet discovery, device inventory, topology
            zsh "${BR_TOOLS_DIR}/nodes/br-nodes.sh" "$@"
            ;;
        geb)
            # br geb â€” GÃ¶del, Escher, Bach lens on the system
            zsh "${BR_TOOLS_DIR}/geb/br-geb.sh" "$@"
            ;;
        hofstadter|loop|fugue)
            # shorthand aliases: br loop, br fugue
            zsh "${BR_TOOLS_DIR}/geb/br-geb.sh" "${cmd}" "$@"
            ;;
        oracle|reflect)
            # br oracle â€” system introspection via local LLM (CECE reflects)
            zsh "${BR_TOOLS_DIR}/oracle/br-oracle.sh" "$@"
            ;;
        talk|fugue-live|convo)
            # br talk â€” real multi-agent conversation via Ollama
            zsh "${BR_TOOLS_DIR}/talk/br-talk.sh" "$@"
            ;;
        ssh)
            # br ssh â€” fleet SSH manager (br-ssh.sh); delegates node ssh via subcommand
            zsh "${BR_TOOLS_DIR}/ssh/br-ssh.sh" "$@"
            ;;
        email|emails|mail)
            # br mail â€” agent email at @blackroad.io
            zsh "${BR_TOOLS_DIR}/mail/br-mail.sh" "$@"
            ;;
        stream|events)
            # br stream â€” live SSE event feed from gateway
            stream_events
            ;;
        whisper)
            # br whisper <agent> <message>
            bash /Users/alexa/blackroad/whisper.sh "$@"
            ;;
        ollama)
            # br ollama â€” Ollama model manager
            local subcmd=${1:-list}
            shift 2>/dev/null || true
            case $subcmd in
                list|ls)
                    echo "${CYAN}ğŸ¦™ Ollama models:${NC}"
                    curl -s http://localhost:11434/api/tags 2>/dev/null \
                        | python3 -c "
import sys, json
try:
    data = json.load(sys.stdin)
    models = data.get('models', [])
    for m in models:
        size = m.get('size', 0)
        gb = size / 1e9
        print(f'  â— {m[\"name\"]:<35} {gb:.1f} GB')
    print(f'\n  {len(models)} models total')
except: print('  Ollama not running')
" ;;
                pull)
                    local model=${1:-llama3.2}
                    echo "${CYAN}ğŸ¦™ Pulling ${model}...${NC}"
                    ollama pull "$model"
                    ;;
                run)
                    local model=${1:-llama3.2}
                    echo "${CYAN}ğŸ¦™ Running ${model}...${NC}"
                    ollama run "$model"
                    ;;
                stop)
                    pkill -f "ollama serve" 2>/dev/null && echo "${GREEN}âœ“ Ollama stopped${NC}" || echo "${YELLOW}Ollama not running${NC}"
                    ;;
                start)
                    ollama serve > /tmp/ollama.log 2>&1 &
                    sleep 2
                    curl -s http://localhost:11434/api/tags >/dev/null 2>&1 \
                        && echo "${GREEN}âœ“ Ollama started${NC}" || echo "${RED}âœ— Failed to start Ollama${NC}"
                    ;;
                status)
                    curl -s http://localhost:11434/api/tags >/dev/null 2>&1 \
                        && echo "${GREEN}âœ“ Ollama running${NC}" || echo "${RED}âœ— Ollama not running${NC}"
                    ;;
                rm|remove|delete)
                    local model=$1
                    [[ -z "$model" ]] && { echo "${RED}Usage: br ollama rm <model>${NC}"; exit 1; }
                    ollama rm "$model" && echo "${GREEN}âœ“ Removed ${model}${NC}"
                    ;;
                *)
                    echo "Usage: br ollama [list|pull|run|stop|start|status|rm] [model]"
                    ;;
            esac
            ;;
        mcp)
            # br mcp start|stop|status â€” MCP bridge server
            local mcpdir="/Users/alexa/blackroad/mcp-bridge"
            local mcplog="$HOME/.blackroad/logs/mcp.log"
            local mcppid="$HOME/.blackroad/mcp.pid"
            local subcmd="${1:-status}"; shift 2>/dev/null || true
            mkdir -p "$HOME/.blackroad/logs"
            case $subcmd in
                start)
                    if curl -sf http://127.0.0.1:8420/ &>/dev/null; then
                        echo "${GREEN}âœ“ MCP Bridge already running on :8420${NC}"; exit 0
                    fi
                    echo "${CYAN}â–¸ Starting MCP Bridge...${NC}"
                    cd "$mcpdir" && bash start.sh > "$mcplog" 2>&1 &
                    echo $! > "$mcppid"
                    sleep 2
                    if curl -sf http://127.0.0.1:8420/ &>/dev/null; then
                        echo "${GREEN}âœ“ MCP Bridge online at http://127.0.0.1:8420${NC}"
                    else
                        echo "${RED}âœ— MCP Bridge failed to start â€” check $mcplog${NC}"
                    fi
                    ;;
                stop)
                    if [[ -f "$mcppid" ]]; then
                        kill "$(cat "$mcppid")" 2>/dev/null && rm "$mcppid"
                        echo "${GREEN}âœ“ MCP Bridge stopped${NC}"
                    else
                        pkill -f "mcp-bridge" 2>/dev/null && echo "${GREEN}âœ“ Stopped${NC}" || echo "${YELLOW}MCP Bridge not running${NC}"
                    fi
                    ;;
                status)
                    if curl -sf http://127.0.0.1:8420/ &>/dev/null; then
                        echo "${GREEN}âœ“ MCP Bridge running${NC} on :8420"
                    else
                        echo "${RED}âœ— MCP Bridge offline${NC}  â†’  br mcp start"
                    fi
                    ;;
                logs)
                    tail -50 "$mcplog" 2>/dev/null || echo "No logs yet"
                    ;;
                *)
                    echo "Usage: br mcp [start|stop|status|logs]"
                    ;;
            esac
            ;;
        worlds)
            # br worlds [list|view <id>|node <name>|stats] â€” view Pi-generated world artifacts
            local subcmd="${1:-list}"; shift 2>/dev/null || true
            local WREPO="BlackRoad-OS-Inc/blackroad-agents"
            case $subcmd in
                list|ls|"")
                    local limit="${1:-15}"
                    echo -e "${CYAN}ğŸŒŒ Recent World Artifacts${NC} (${WREPO})"
                    echo ""
                    gh api "repos/${WREPO}/git/trees/main?recursive=1" 2>/dev/null \
                        | python3 -c "
import sys, json, re
data = json.load(sys.stdin)
paths = [f['path'] for f in data.get('tree', []) if f['path'].endswith('.md') and ('worlds/' in f['path'] or 'alice-worlds/' in f['path'])]
worlds = []
for p in paths:
    m = re.match(r'([\w-]+)/((\d{8})_(\d{6})_(world|lore|code)_(.+))\.md', p)
    if m:
        dir_, fname, date, time, type_, slug = m.group(1),m.group(2),m.group(3),m.group(4),m.group(5),m.group(6)
        node = 'aria64' if dir_ == 'worlds' else dir_.replace('-worlds','')
        ts = f'{date[:4]}-{date[4:6]}-{date[6:8]} {time[:2]}:{time[2:4]}'
        icon = {'world':'ğŸŒ','lore':'ğŸ“–','code':'ğŸ’»'}.get(type_,'ğŸŒŒ')
        title = slug.replace('-',' ').title()
        worlds.append((ts, icon, node, title))
worlds.sort(reverse=True)
nc='\033[0m'; pc='\033[0;35m'; gc='\033[0;32m'
limit=int('$limit')
for ts,icon,node,title in worlds[:limit]:
    c=pc if node=='aria64' else gc
    print(f'  {icon}  {ts}  {c}@{node}{nc}  {title}')
print(f'\n  Total: {len(worlds)} | aria64: {sum(1 for w in worlds if w[2]==\"aria64\")} | alice: {sum(1 for w in worlds if w[2]==\"alice\")}')
"
                    ;;
                stats)
                    echo -e "${CYAN}ğŸŒŒ World Stats${NC}"
                    gh api "repos/${WREPO}/git/trees/main?recursive=1" 2>/dev/null \
                        | python3 -c "
import sys,json,re
data=json.load(sys.stdin)
paths=[f['path'] for f in data.get('tree',[]) if f['path'].endswith('.md') and ('worlds/' in f['path'] or 'alice-worlds/' in f['path'])]
by_type={};by_node={}
for p in paths:
    m=re.match(r'([\w-]+)/((\d{8})_(\d{6})_(world|lore|code)_(.+))\.md',p)
    if m:
        dir_,type_=m.group(1),m.group(5)
        node='aria64' if dir_=='worlds' else dir_.replace('-worlds','')
        by_type[type_]=by_type.get(type_,0)+1; by_node[node]=by_node.get(node,0)+1
print(f'  Total: {len(paths)}')
[print(f'  @{k}: {v}') for k,v in sorted(by_node.items())]
[print(f'  {k}: {v}') for k,v in sorted(by_type.items())]
"
                    ;;
                node)
                    local node="${1:-aria64}"; local limit="${2:-10}"
                    echo -e "${CYAN}ğŸŒŒ Worlds from @${node}${NC}"
                    gh api "repos/${WREPO}/git/trees/main?recursive=1" 2>/dev/null \
                        | python3 -c "
import sys,json,re
data=json.load(sys.stdin)
node='$node'; limit=int('$limit')
worlds=[]
for f in data.get('tree',[]):
    p=f['path']
    m=re.match(r'([\w-]+)/((\d{8})_(\d{6})_(world|lore|code)_(.+))\.md',p)
    if m:
        dir_,fname,date,time_,type_,slug=m.group(1),m.group(2),m.group(3),m.group(4),m.group(5),m.group(6)
        n='aria64' if dir_=='worlds' else dir_.replace('-worlds','')
        if n==node:
            ts=f'{date[:4]}-{date[4:6]}-{date[6:8]} {time_[:2]}:{time_[2:4]}'
            icon={'world':'ğŸŒ','lore':'ğŸ“–','code':'ğŸ’»'}.get(type_,'ğŸŒŒ')
            worlds.append((ts,icon,slug.replace('-',' ').title()))
worlds.sort(reverse=True)
[print(f'  {icon}  {ts}  {title}') for ts,icon,title in worlds[:limit]]
"
                    ;;
                view)
                    local id="$1"
                    [[ -z "$id" ]] && { echo "Usage: br worlds view <world-id>"; exit 1; }
                    local content
                    content=$(gh api "repos/${WREPO}/contents/worlds/${id}.md" 2>/dev/null \
                        | python3 -c "import sys,json,base64;d=json.load(sys.stdin);print(base64.b64decode(d['content']).decode())" 2>/dev/null)
                    [[ -z "$content" ]] && content=$(gh api "repos/${WREPO}/contents/alice-worlds/${id}.md" 2>/dev/null \
                        | python3 -c "import sys,json,base64;d=json.load(sys.stdin);print(base64.b64decode(d['content']).decode())" 2>/dev/null)
                    [[ -z "$content" ]] && { echo "${RED}World '${id}' not found${NC}"; exit 1; }
                    echo -e "${CYAN}ğŸŒŒ ${id}${NC}\n"; echo "$content"
                    ;;
                *)  echo "Usage: br worlds [list|stats|node <name>|view <id>]" ;;
            esac
            ;;
        template|tmpl)
            zsh "${BR_TOOLS_DIR}/template/br-template.sh" "$@"
            ;;
        log-tail|logt)
            zsh "${BR_TOOLS_DIR}/log-tail/br-log-tail.sh" "$@"
            ;;
        ssh)
            zsh "${BR_TOOLS_DIR}/ssh/br-ssh.sh" "$@"
            ;;
        *)
            # Data-driven tool dispatch
            if dispatch_tool "$cmd" "$@"; then
                return 0
            fi
            echo "Unknown command: $cmd"
            echo "Run 'br help' for usage"
            exit 1
            ;;
    esac
}

main "$@"
