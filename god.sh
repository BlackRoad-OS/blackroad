#!/bin/bash

tput civis
trap 'tput cnorm; exit' INT

while true; do
  clear
  TS=$(date +%H:%M:%S)
  
  echo -e "\033[1;35m┌─────────────────────────────────────┬────────────────────────────────────────┐\033[0m"
  echo -e "\033[1;35m│\033[0m \033[1;37mAGENTS\033[0m                              \033[1;35m│\033[0m \033[1;37mMETRICS\033[0m                     $TS    \033[1;35m│\033[0m"
  echo -e "\033[1;35m├─────────────────────────────────────┼────────────────────────────────────────┤\033[0m"
  echo -e "\033[1;35m│\033[0m \033[1;31m●\033[0m LUCIDIA  \033[1;32mON\033[0m  ████░░░░ $((RANDOM%30+10))%       \033[1;35m│\033[0m CPU  \033[1;36m████████░░░░░░░░\033[0m $((RANDOM%30+20))%        \033[1;35m│\033[0m"
  echo -e "\033[1;35m│\033[0m \033[1;36m●\033[0m ALICE    \033[1;32mON\033[0m  ██████░░ $((RANDOM%30+40))%       \033[1;35m│\033[0m MEM  \033[1;33m██████████░░░░░░\033[0m $((RANDOM%20+50))%        \033[1;35m│\033[0m"
  echo -e "\033[1;35m│\033[0m \033[1;32m●\033[0m OCTAVIA  \033[1;32mON\033[0m  █████░░░ $((RANDOM%30+30))%       \033[1;35m│\033[0m NET  \033[1;32m██████░░░░░░░░░░\033[0m $((RANDOM%20+20))%        \033[1;35m│\033[0m"
  echo -e "\033[1;35m│\033[0m \033[1;33m●\033[0m PRISM    \033[1;32mON\033[0m  ███░░░░░ $((RANDOM%20+15))%       \033[1;35m│\033[0m GPU  \033[1;35m████████████░░░░\033[0m $((RANDOM%20+70))%        \033[1;35m│\033[0m"
  echo -e "\033[1;35m│\033[0m \033[1;35m●\033[0m ECHO     \033[1;32mON\033[0m  ██░░░░░░ $((RANDOM%15+5))%        \033[1;35m│\033[0m                                        \033[1;35m│\033[0m"
  echo -e "\033[1;35m│\033[0m \033[1;34m●\033[0m CIPHER   \033[1;32mON\033[0m  ████████ $((RANDOM%20+75))%       \033[1;35m│\033[0m Tasks: $((RANDOM%50+20))  Msgs: $((RANDOM%200+100))/s       \033[1;35m│\033[0m"
  echo -e "\033[1;35m├─────────────────────────────────────┼────────────────────────────────────────┤\033[0m"
  echo -e "\033[1;35m│\033[0m \033[1;37mEVENTS\033[0m                              \033[1;35m│\033[0m \033[1;37mSERVICES\033[0m                               \033[1;35m│\033[0m"
  echo -e "\033[1;35m├─────────────────────────────────────┼────────────────────────────────────────┤\033[0m"
  echo -e "\033[1;35m│\033[0m \033[2m$TS\033[0m \033[1;36mALICE\033[0m route.complete       \033[1;35m│\033[0m \033[1;32m●\033[0m Gateway    :8080  \033[1;32mUP\033[0m                \033[1;35m│\033[0m"
  echo -e "\033[1;35m│\033[0m \033[2m$TS\033[0m \033[1;33mPRISM\033[0m pattern.found        \033[1;35m│\033[0m \033[1;32m●\033[0m NATS       :4222  \033[1;32mUP\033[0m                \033[1;35m│\033[0m"
  echo -e "\033[1;35m│\033[0m \033[2m$TS\033[0m \033[1;32mOCTAVIA\033[0m inference.done     \033[1;35m│\033[0m \033[1;32m●\033[0m Milvus     :6333  \033[1;32mUP\033[0m                \033[1;35m│\033[0m"
  echo -e "\033[1;35m│\033[0m \033[2m$TS\033[0m \033[1;35mECHO\033[0m memory.commit         \033[1;35m│\033[0m \033[1;32m●\033[0m Ollama     :11434 \033[1;32mUP\033[0m                \033[1;35m│\033[0m"
  echo -e "\033[1;35m│\033[0m \033[2m$TS\033[0m \033[1;34mCIPHER\033[0m auth.success        \033[1;35m│\033[0m \033[1;32m●\033[0m Metrics    :9090  \033[1;32mUP\033[0m                \033[1;35m│\033[0m"
  echo -e "\033[1;35m├─────────────────────────────────────┴────────────────────────────────────────┤\033[0m"
  echo -e "\033[1;35m│\033[0m \033[1;37mTRAFFIC\033[0m                                                                    \033[1;35m│\033[0m"
  echo -e "\033[1;35m│\033[0m                                                                              \033[1;35m│\033[0m"
  
  # Random traffic patterns
  for _ in {1..3}; do
    s=$((RANDOM % 6))
    d=$((RANDOM % 6))
    while [ $d -eq $s ]; do d=$((RANDOM % 6)); done
    NAMES=("L" "A" "O" "P" "E" "C")
    COLS=("1;31" "1;36" "1;32" "1;33" "1;35" "1;34")
    echo -e "\033[1;35m│\033[0m  \033[${COLS[$s]}m${NAMES[$s]}\033[0m ══════════════════════════════════════════════════════════▶ \033[${COLS[$d]}m${NAMES[$d]}\033[0m   \033[1;35m│\033[0m"
  done
  
  echo -e "\033[1;35m│\033[0m                                                                              \033[1;35m│\033[0m"
  echo -e "\033[1;35m├──────────────────────────────────────────────────────────────────────────────┤\033[0m"
  echo -e "\033[1;35m│\033[0m  \033[1;32m●\033[0m \033[1;37mSYSTEM NOMINAL\033[0m                                         \033[2mq to quit\033[0m   \033[1;35m│\033[0m"
  echo -e "\033[1;35m└──────────────────────────────────────────────────────────────────────────────┘\033[0m"
  
  read -t 0.5 -n 1 key && [ "$key" = "q" ] && break
done

tput cnorm
