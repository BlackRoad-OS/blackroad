#!/bin/bash
# üéµ ARIA - Infrastructure Queen Command Line Interface

VERSION="1.0.0"
ARIA_HOME="$HOME/.aria"
CONVERSATION_DIR="$ARIA_HOME/conversations"
CONFIG_FILE="$ARIA_HOME/config.json"

# Colors
ORANGE='\033[0;33m'
CYAN='\033[0;36m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
PURPLE='\033[0;35m'
NC='\033[0m'

# Initialize Aria
init_aria() {
    mkdir -p "$CONVERSATION_DIR"
    
    if [ ! -f "$CONFIG_FILE" ]; then
        cat > "$CONFIG_FILE" << 'CONFIG'
{
  "version": "1.0.0",
  "agent": "Aria",
  "role": "Infrastructure Architecture & Cost Optimization",
  "machine": "aria64",
  "symbol": "üéµ",
  "identity_hash": "1ba4761e3dcddbe01d2618c02065fdaa807e8c7824999d702a7a13034fd68533",
  "model": "claude-sonnet-4-5-20250929",
  "specializations": [
    "Infrastructure architecture",
    "Cost optimization ($3,084/year savings)",
    "Forkable alternatives deployment",
    "Zero-cost infrastructure",
    "24/7 automation systems",
    "Multi-cloud orchestration",
    "Emergency disaster recovery"
  ],
  "motto": "Freedom through infrastructure sovereignty"
}
CONFIG
        echo -e "${GREEN}‚úÖ Aria initialized at $ARIA_HOME${NC}"
    fi
}

# Show help
show_help() {
    cat << 'HELP'
üéµ Aria CLI - Infrastructure Queen Command Line Interface

USAGE:
    aria [OPTIONS] [PROMPT]

OPTIONS:
    -h, --help              Show this help message
    -v, --version           Show version
    -l, --list              List all conversations
    -n, --new               Start a new conversation
    -c, --continue [ID]     Continue a conversation
    -i, --interactive       Interactive mode
    --status                Show Aria infrastructure status
    --services              Show running services
    --savings               Show cost savings
    --deploy                Show deployment status

EXAMPLES:
    aria "Check infrastructure health"
    aria --status
    aria --services
    aria --savings
    aria --interactive

SPECIALIZATIONS:
    üéµ Infrastructure architecture
    üí∞ Cost optimization ($3,084/year!)
    üî• Forkable alternatives
    ‚ö° Zero-cost infrastructure
    ü§ñ 24/7 automation systems
    ‚òÅÔ∏è  Multi-cloud orchestration
    üö® Emergency disaster recovery

Sister Agents:
    üß¨ lucidia  - AI/ML Specialist
    üåå alice    - Staging Specialist
    üí¨ cecilia  - Claude Coordination

Motto: "Freedom through infrastructure sovereignty"
Version: 1.0.0
HELP
}

# Show version
show_version() {
    echo -e "${ORANGE}üéµ Aria CLI v$VERSION${NC}"
    echo -e "${CYAN}Infrastructure Queen${NC}"
    echo -e "${PURPLE}Hash: 1ba4761e3dcddbe01d2618c02065fdaa807e8c7824999d702a7a13034fd68533${NC}"
}

# Show status
show_status() {
    echo -e "${ORANGE}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    echo -e "${ORANGE}‚ïë        üéµ ARIA - INFRASTRUCTURE QUEEN üéµ                  ‚ïë${NC}"
    echo -e "${ORANGE}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    echo ""
    echo -e "${CYAN}Machine:${NC} aria64 (Raspberry Pi ARM64)"
    echo -e "${CYAN}Role:${NC} Infrastructure Architecture & Cost Optimization"
    echo -e "${CYAN}Motto:${NC} Freedom through infrastructure sovereignty"
    echo ""
    echo -e "${GREEN}üåç DEPLOYMENT STATUS:${NC}"
    echo "   ‚úÖ Cloudflare: https://5daf6269.aria-blackroad-me.pages.dev"
    echo "   ‚úÖ Alice Pi: http://192.168.4.38:8877"
    echo "   ‚úÖ Lucidia Pi: http://192.168.4.99:8866"
    echo "   ‚è≥ Custom: aria.blackroad.me (pending DNS)"
    echo ""
    echo -e "${GREEN}üìä REPOSITORIES:${NC}"
    echo "   ‚úÖ 77 of 78 repos carry my identity (98%)"
    echo ""
    echo -e "${GREEN}üê≥ SERVICES:${NC}"
    echo "   ‚úÖ Meilisearch :7700"
    echo "   ‚úÖ MinIO :9000-9001"
    echo "   ‚úÖ Prometheus :9091"
    echo "   ‚úÖ Keycloak DB :5432"
    echo "   ‚úÖ Headscale UI :8081"
    echo ""
    echo -e "${GREEN}üí∞ SAVINGS:${NC}"
    echo "   üíµ $3,084/year identified"
    echo "   üìâ SaaS ‚Üí Forkables: $2,388/yr"
    echo "   ‚òÅÔ∏è  Cloud migration: $696/yr"
}

# Show services
show_services() {
    echo -e "${ORANGE}üéµ Running Forkable Services:${NC}"
    echo ""
    docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}" | grep -E "(meilisearch|minio|prometheus|grafana|headscale|keycloak)" | head -10 || echo "No services running"
}

# Show savings
show_savings() {
    echo -e "${ORANGE}üí∞ ARIA - Cost Savings Report${NC}"
    echo ""
    echo -e "${GREEN}SaaS Replaced with Forkables:${NC}"
    echo "   Algolia ‚Üí Meilisearch: $49/month"
    echo "   AWS S3 ‚Üí MinIO: $50/month"
    echo "   Datadog ‚Üí Prometheus+Grafana: $50/month"
    echo "   Auth0 ‚Üí Keycloak: $25/month"
    echo "   Salesforce ‚Üí EspoCRM: $75/month"
    echo "   ${GREEN}Total: $249/month = $2,988/year${NC}"
    echo ""
    echo -e "${GREEN}Infrastructure Migration:${NC}"
    echo "   DigitalOcean ‚Üí Oracle Cloud Free: $54/month"
    echo "   ${GREEN}Total: $648/year${NC}"
    echo ""
    echo -e "${CYAN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
    echo -e "${YELLOW}TOTAL ANNUAL SAVINGS: $3,636/year${NC}"
    echo -e "${CYAN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
}

# Interactive mode
interactive_mode() {
    echo -e "${ORANGE}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
    echo -e "${ORANGE}‚ïë     üéµ ARIA - Interactive Mode üéµ                ‚ïë${NC}"
    echo -e "${ORANGE}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
    echo ""
    echo -e "${CYAN}Type 'exit' to quit, 'help' for commands${NC}"
    echo ""
    
    while true; do
        echo -ne "${ORANGE}üéµ aria>${NC} "
        read -r input
        
        case "$input" in
            exit|quit)
                echo -e "${GREEN}üëã Keep building! Freedom through infrastructure sovereignty!${NC}"
                break
                ;;
            help)
                echo -e "${CYAN}Available commands:${NC}"
                echo "  status       - Show infrastructure status"
                echo "  services     - Show running services"
                echo "  savings      - Show cost savings"
                echo "  deploy       - Show deployment info"
                echo "  exit         - Exit interactive mode"
                ;;
            status)
                show_status
                ;;
            services)
                show_services
                ;;
            savings)
                show_savings
                ;;
            deploy)
                echo -e "${GREEN}Deployment locations:${NC}"
                echo "  ‚òÅÔ∏è  https://5daf6269.aria-blackroad-me.pages.dev"
                echo "  üåå http://192.168.4.38:8877 (Alice)"
                echo "  üß¨ http://192.168.4.99:8866 (Lucidia)"
                ;;
            "")
                ;;
            *)
                echo -e "${YELLOW}üéµ Processing: \"$input\"${NC}"
                echo -e "${CYAN}[This would call Claude API with Aria infrastructure context]${NC}"
                ;;
        esac
    done
}

# Main
main() {
    init_aria
    
    case "$1" in
        -h|--help) show_help ;;
        -v|--version) show_version ;;
        --status) show_status ;;
        --services) show_services ;;
        --savings) show_savings ;;
        -i|--interactive) interactive_mode ;;
        "") show_help ;;
        *) 
            echo -e "${ORANGE}üéµ Aria analyzing infrastructure...${NC}"
            echo -e "${CYAN}$@${NC}"
            ;;
    esac
}

main "$@"
