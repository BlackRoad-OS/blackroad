name: Bot - Documentation Update

on:
  push:
    branches: [main, master]
    paths:
      - 'src/**'
      - 'lib/**'
      - '*.md'
  schedule:
    - cron: '0 0 * * 1'
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  update-docs:
    runs-on: [self-hosted, blackroad-fleet]
    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GH_PAT || secrets.GITHUB_TOKEN }}

      - name: Update README timestamp
        run: |
          if [ -f README.md ]; then
            DATE=$(date -u '+%Y-%m-%d')
            if grep -q "Last updated:" README.md; then
              sed -i "s/Last updated: .*/Last updated: $DATE/" README.md
            fi
            git config user.email "actions@blackroad.io"
            git config user.name "BlackRoad Bot"
            git add README.md
            git diff --staged --quiet || git commit -m "docs: auto-update timestamp [skip ci]"
            git push origin HEAD || true
          fi
          echo "Docs check complete"
